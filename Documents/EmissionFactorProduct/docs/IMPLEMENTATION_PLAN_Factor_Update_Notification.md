# Cedars EFs ä¿‚æ•¸æ›´æ–°é€šçŸ¥ç³»çµ± - å¯¦æ–½è¨ˆç•«

## ğŸ“‹ æ–‡æª”è³‡è¨Š
- **ç‰ˆæœ¬**: v1.0
- **å»ºç«‹æ—¥æœŸ**: 2025-11-19
- **è² è²¬äºº**: ç”¢å“åœ˜éšŠ
- **ç‹€æ…‹**: è¦åŠƒä¸­

---

## ğŸ“– ç›®éŒ„
1. [éœ€æ±‚æ¦‚è¿°](#éœ€æ±‚æ¦‚è¿°)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [ç³»çµ±æ¶æ§‹èª¿æ•´](#ç³»çµ±æ¶æ§‹èª¿æ•´)
4. [è³‡æ–™çµæ§‹è¨­è¨ˆ](#è³‡æ–™çµæ§‹è¨­è¨ˆ)
5. [å¯¦æ–½æ­¥é©Ÿ](#å¯¦æ–½æ­¥é©Ÿ)
6. [UI/UX è¨­è¨ˆ](#uiux-è¨­è¨ˆ)
7. [æ¸¬è©¦è¨ˆç•«](#æ¸¬è©¦è¨ˆç•«)
8. [é©—æ”¶æ¨™æº–](#é©—æ”¶æ¨™æº–)

---

## éœ€æ±‚æ¦‚è¿°

### æ¥­å‹™èƒŒæ™¯

Cedars EFs Libraryï¼ˆå¸Œé”ä¿‚æ•¸åº«ï¼‰æœƒå®šæœŸæ›´æ–°æ’æ”¾ä¿‚æ•¸è³‡æ–™ã€‚æ›´æ–°çš„æ–¹å¼æ˜¯ï¼š
- **æ–°å¢æ–°ä¿‚æ•¸**ï¼ˆä¾‹å¦‚ï¼šResource_8ï¼‰
- **æ¨™è¨˜æ–°ä¿‚æ•¸**ç‚ºæŸå€‹èˆŠä¿‚æ•¸ï¼ˆä¾‹å¦‚ï¼šResource_1ï¼‰çš„æ›´æ–°ç‰ˆ
- **èˆŠä¿‚æ•¸ä¿ç•™**ï¼Œä¸æœƒè¢«åˆªé™¤æˆ–è¦†è“‹

### å•é¡Œé™³è¿°

ç•¶ä½¿ç”¨è€…å·²å°‡ Resource_1 çš„ä¿‚æ•¸åŒ¯å…¥åˆ°ä¸­å¤®ä¿‚æ•¸åº«ä¸¦åœ¨å°ˆæ¡ˆä¸­ä½¿ç”¨æ™‚ï¼Œå¦‚æœå¸Œé”ä¿‚æ•¸åº«æ–°å¢äº† Resource_8ï¼ˆæ¨™è¨˜ç‚º Resource_1 çš„æ–°ç‰ˆæœ¬ï¼‰ï¼Œä½¿ç”¨è€…ç›®å‰ï¼š
- âŒ **ç„¡æ³•å¾—çŸ¥**æœ‰æ–°ç‰ˆæœ¬å¯ç”¨
- âŒ **ç„¡æ³•æ¯”è¼ƒ**æ–°èˆŠç‰ˆæœ¬çš„å·®ç•°
- âŒ **ç„¡æ³•é¸æ“‡**æ˜¯å¦æ¡ç”¨æ–°ç‰ˆæœ¬

### è§£æ±ºæ–¹æ¡ˆ

å»ºç«‹ä¿‚æ•¸æ›´æ–°é€šçŸ¥ç³»çµ±ï¼Œå¯¦ç¾ï¼š
1. âœ… **è‡ªå‹•åµæ¸¬**å¸Œé”ä¿‚æ•¸åº«çš„æ–°ç‰ˆæœ¬
2. âœ… **æ™ºèƒ½æ¯”å°**ä¸­å¤®åº«ä¸­å—å½±éŸ¿çš„ä¿‚æ•¸
3. âœ… **é¡¯ç¤ºé€šçŸ¥**æé†’ä½¿ç”¨è€…æœ‰æ–°ç‰ˆæœ¬å¯ç”¨
4. âœ… **å·®ç•°æ¯”å°**å±•ç¤ºæ–°èˆŠç‰ˆæœ¬çš„å…·é«”è®Šæ›´
5. âœ… **ä¸€éµæ–°å¢**è®“ä½¿ç”¨è€…å¯é¸æ“‡å°‡æ–°ç‰ˆæœ¬åŠ å…¥ä¸­å¤®åº«
6. âœ… **ä¸¦å­˜ç®¡ç†**æ–°èˆŠç‰ˆæœ¬å¯åŒæ™‚å­˜åœ¨æ–¼ä¸­å¤®åº«

---

## æ ¸å¿ƒæ¦‚å¿µ

### ç‰ˆæœ¬ä¸¦å­˜ vs ç‰ˆæœ¬å–ä»£

**é—œéµç†è§£**ï¼šæ–°ç‰ˆæœ¬ä¸æœƒå–ä»£èˆŠç‰ˆæœ¬ï¼Œè€Œæ˜¯**ä¸¦å­˜**

```
å¸Œé”ä¿‚æ•¸åº«ï¼ˆCedars EFs Libraryï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                             â”‚
â”‚  Resource_1 (2024Q1)                        â”‚
â”‚  â”œâ”€ ID: 1001                                â”‚
â”‚  â”œâ”€ é›»åŠ›-å°é›»é›»ç¶²å¹³å‡æ’æ”¾ä¿‚æ•¸                 â”‚
â”‚  â””â”€ 0.502 kg COâ‚‚e/kWh                      â”‚
â”‚                                             â”‚
â”‚  Resource_8 (2024Q3)                        â”‚
â”‚  â”œâ”€ ID: 1002                                â”‚
â”‚  â”œâ”€ é›»åŠ›-å°é›»é›»ç¶²å¹³å‡æ’æ”¾ä¿‚æ•¸                 â”‚
â”‚  â”œâ”€ 0.495 kg COâ‚‚e/kWh                      â”‚
â”‚  â””â”€ ğŸ“Œ æ¨™è¨˜ï¼šé€™æ˜¯ Resource_1 çš„æ–°ç‰ˆæœ¬        â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ä½¿ç”¨è€…åŒ¯å…¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸­å¤®ä¿‚æ•¸åº«ï¼ˆCentral Libraryï¼‰                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  âœ… å¾ Resource_1 åŒ¯å…¥ (Central ID: 5001)    â”‚
â”‚  â”œâ”€ 0.502 kg COâ‚‚e/kWh                      â”‚
â”‚  â”œâ”€ è¢« 3 å€‹å°ˆæ¡ˆå¼•ç”¨                          â”‚
â”‚  â””â”€ ğŸ”” é¡¯ç¤ºï¼šæœ‰æ–°ç‰ˆæœ¬å¯ç”¨                    â”‚
â”‚                                             â”‚
â”‚  âœ… å¾ Resource_8 åŒ¯å…¥ (Central ID: 5002)    â”‚
â”‚  â”œâ”€ 0.495 kg COâ‚‚e/kWh                      â”‚
â”‚  â””â”€ æœªè¢«å¼•ç”¨ï¼ˆä½¿ç”¨è€…æ–°å¢å¾Œçš„åˆå§‹ç‹€æ…‹ï¼‰         â”‚
â”‚                                             â”‚
â”‚  âš ï¸ å…©å€‹ç‰ˆæœ¬åŒæ™‚å­˜åœ¨ï¼Œäº’ä¸å½±éŸ¿                â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è³‡æ–™æµå‘

```mermaid
graph TB
    subgraph Xida["å¸Œé”ä¿‚æ•¸åº«"]
        X1[Resource_1<br/>ID: 1001<br/>v2.1.0]
        X2[Resource_8<br/>ID: 1002<br/>v2.3.0<br/>ğŸ“Œ æ–°ç‰ˆæœ¬]
    end

    subgraph Central["ä¸­å¤®ä¿‚æ•¸åº«"]
        C1[å‰¯æœ¬ from Resource_1<br/>Central ID: 5001<br/>ğŸ”” æœ‰æ–°ç‰ˆæœ¬é€šçŸ¥]
        C2[å‰¯æœ¬ from Resource_8<br/>Central ID: 5002<br/>ğŸ“ æœªè¢«å¼•ç”¨]
    end

    subgraph Projects["å°ˆæ¡ˆå±¤"]
        P1[å°ˆæ¡ˆ A<br/>å¼•ç”¨ 5001]
        P2[å°ˆæ¡ˆ B<br/>å¼•ç”¨ 5001]
        P3[å°ˆæ¡ˆ C<br/>å¼•ç”¨ 5001]
    end

    X1 -.->|åŒ¯å…¥æ™‚è¤‡è£½| C1
    X2 -.->|ä½¿ç”¨è€…é¸æ“‡æ–°å¢| C2

    C1 -->|è¢«å¼•ç”¨| P1
    C1 -->|è¢«å¼•ç”¨| P2
    C1 -->|è¢«å¼•ç”¨| P3

    C2 -.->|åˆå§‹ç‹€æ…‹ï¼šæœªè¢«å¼•ç”¨| Projects

    X2 -->|is_newer_version_of| X1
    X2 -->|è§¸ç™¼é€šçŸ¥| C1
```

---

## ç³»çµ±æ¶æ§‹èª¿æ•´

### èª¿æ•´ 1: å¸Œé”ä¿‚æ•¸åŒ¯å…¥æ–¹å¼æ”¹è®Š

#### ç¾ç‹€ï¼ˆéœ€è¦ä¿®æ”¹ï¼‰

```typescript
// ç¾åœ¨ï¼šå¸Œé”ä¿‚æ•¸ä¸æœƒè¢«è¤‡è£½ï¼Œåªæ˜¯æ”¹è®Šå¯è¦‹æ€§
addStandardFactorToCentral(factorId) {
  removedFromCentralIds.delete(factorId)
}

getCentralLibraryFactors() {
  // éæ¿¾é¡¯ç¤ºæ‰€æœ‰æœªè¢«ç§»é™¤çš„ä¿‚æ•¸
  return allFactors.filter(f => !removedFromCentralIds.has(f.id))
}
```

**å•é¡Œ**ï¼š
- âŒ å¸Œé”ä¿‚æ•¸èˆ‡ä¸­å¤®åº«ä¿‚æ•¸æ˜¯åŒä¸€å€‹ç‰©ä»¶
- âŒ ç„¡æ³•ç¨ç«‹è¿½è¹¤ä¸­å¤®åº«ä¿‚æ•¸çš„ä½¿ç”¨æƒ…æ³
- âŒ å¸Œé”ä¿‚æ•¸æ›´æ–°æœƒç›´æ¥å½±éŸ¿ä¸­å¤®åº«

#### ç›®æ¨™æ¶æ§‹

```typescript
// æœªä¾†ï¼šå¸Œé”ä¿‚æ•¸æœƒè¢«è¤‡è£½åˆ°ä¸­å¤®åº«
addStandardFactorToCentral(factorId) {
  const xidaFactor = getEmissionFactorById(factorId)

  // å»ºç«‹ç¨ç«‹çš„ä¸­å¤®åº«å‰¯æœ¬
  const centralFactor: CentralLibraryStandardFactor = {
    ...xidaFactor,
    id: Date.now(),                    // æ–°çš„ä¸­å¤®åº« ID
    type: 'central_standard_factor',
    source_xida_id: factorId,          // è¿½è¹¤ä¾†æº
    source_resource_id: xidaFactor.resource_id,
    imported_to_central_at: new Date().toISOString(),
    usage_info: {                      // ç¨ç«‹çš„ä½¿ç”¨è¿½è¹¤
      total_usage_count: 0,
      project_references: []
    }
  }

  importedStandardFactors.push(centralFactor)
}

getCentralLibraryFactors() {
  return [
    ...importedCompositeFactors,      // çµ„åˆä¿‚æ•¸
    ...importedStandardFactors,       // ğŸ†• è¤‡è£½çš„å¸Œé”ä¿‚æ•¸
    ...importedProductFootprints      // ç”¢å“ç¢³è¶³è·¡
  ]
}
```

**å„ªé»**ï¼š
- âœ… å¸Œé”ä¿‚æ•¸èˆ‡ä¸­å¤®åº«ä¿‚æ•¸å®Œå…¨ç¨ç«‹
- âœ… å¯ç¨ç«‹è¿½è¹¤ä¸­å¤®åº«ä¿‚æ•¸çš„ä½¿ç”¨
- âœ… å¸Œé”ä¿‚æ•¸æ›´æ–°ä¸æœƒå½±éŸ¿å·²åŒ¯å…¥çš„ä¸­å¤®åº«ä¿‚æ•¸
- âœ… æ”¯æ´ç‰ˆæœ¬ä¸¦å­˜

---

## è³‡æ–™çµæ§‹è¨­è¨ˆ

### 1. EmissionFactor æ“´å±•

**æª”æ¡ˆ**: `src/types/types.ts`

```typescript
export interface EmissionFactor {
  // ========== ç¾æœ‰æ¬„ä½ä¿æŒä¸è®Š ==========
  id: number
  source: string
  name: string
  effective_date: string
  continent: string
  country: string
  region?: string
  co2_factor: number
  co2_unit: string
  ch4_factor?: number
  ch4_unit?: string
  n2o_factor?: number
  n2o_unit?: string
  value: number
  unit: string
  year?: number
  method_gwp?: string
  source_type: SourceType
  source_ref?: string
  version: string
  description?: string
  notes?: string
  created_at: string
  updated_at: string

  // ========== ğŸ†• æ–°å¢ï¼šè³‡æ–™ä¾†æºç‰ˆæœ¬è¿½è¹¤ ==========
  resource_id?: string              // è³‡æ–™ä¾†æº ID (å¦‚: "Resource_1", "Resource_8")
  resource_name?: string            // è³‡æ–™ä¾†æºåç¨± (å¦‚: "TW2050 2024Q1")
  resource_version?: string         // è³‡æ–™ä¾†æºç‰ˆæœ¬è™Ÿ (å¦‚: "v2.1.0")
  resource_published_date?: string  // è³‡æ–™ä¾†æºç™¼å¸ƒæ—¥æœŸ

  // ========== ğŸ†• æ–°å¢ï¼šç‰ˆæœ¬é—œè¯è¿½è¹¤ ==========
  is_newer_version_of?: {           // å¦‚æœé€™æ˜¯æŸå€‹ä¿‚æ•¸çš„æ–°ç‰ˆæœ¬
    previous_resource_id: string    // å‰ä¸€å€‹è³‡æ–™ä¾†æº ID (å¦‚: "Resource_1")
    previous_factor_name: string    // å‰ä¸€å€‹ä¿‚æ•¸åç¨±ï¼ˆç”¨æ–¼æ™ºèƒ½æ¯”å°ï¼‰
    previous_factor_uuid?: string   // å‰ä¸€å€‹ä¿‚æ•¸ UUIDï¼ˆå¦‚æœæœ‰ï¼‰
    update_reason?: string          // æ›´æ–°åŸå› èªªæ˜
    update_date: string             // æ›´æ–°æ—¥æœŸ
    change_summary?: string         // è®Šæ›´æ‘˜è¦æ–‡å­—
    breaking_changes?: boolean      // æ˜¯å¦ç‚ºé‡å¤§è®Šæ›´
  }

  // ========== ğŸ†• æ–°å¢ï¼šä¸­å¤®åº«ç‹€æ…‹è¿½è¹¤ ==========
  in_central_library?: boolean      // å¿«é€ŸæŸ¥è©¢ï¼šæ˜¯å¦å·²åœ¨ä¸­å¤®åº«
  central_library_copies?: Array<{  // ä¸­å¤®åº«å‰¯æœ¬åˆ—è¡¨
    central_id: number              // ä¸­å¤®åº«å‰¯æœ¬ ID
    imported_at: string             // åŒ¯å…¥æ™‚é–“
    locked: boolean                 // æ˜¯å¦é–å®šç‰ˆæœ¬
  }>
}
```

### 2. CentralLibraryStandardFactorï¼ˆæ–°å¢ï¼‰

**èªªæ˜**ï¼šä¸­å¤®åº«ä¸­å¸Œé”ä¿‚æ•¸çš„å‰¯æœ¬å‹åˆ¥

```typescript
/**
 * ä¸­å¤®åº«ä¸­çš„å¸Œé”ä¿‚æ•¸å‰¯æœ¬
 * ç•¶ä½¿ç”¨è€…å°‡å¸Œé”ä¿‚æ•¸åŒ¯å…¥ä¸­å¤®åº«æ™‚å»ºç«‹
 */
export interface CentralLibraryStandardFactor {
  // ========== åŸºæœ¬è³‡è¨Šï¼ˆå¾ EmissionFactor è¤‡è£½ï¼‰ ==========
  id: number                        // ğŸ”‘ ä¸­å¤®åº«å°ˆå±¬ IDï¼ˆä¸èˆ‡å¸Œé”ä¿‚æ•¸ ID è¡çªï¼‰
  type: 'central_standard_factor'   // ğŸ”‘ å›ºå®šé¡å‹æ¨™è¨˜

  // å¾ EmissionFactor è¤‡è£½çš„æ‰€æœ‰åŸºæœ¬æ¬„ä½
  source: string
  name: string
  effective_date: string
  continent: string
  country: string
  region?: string
  co2_factor: number
  co2_unit: string
  ch4_factor?: number
  ch4_unit?: string
  n2o_factor?: number
  n2o_unit?: string
  value: number
  unit: string
  year?: number
  method_gwp?: string
  source_type: SourceType
  source_ref?: string
  version: string
  description?: string
  notes?: string
  created_at: string
  updated_at: string

  // è³‡æ–™ä¾†æºè³‡è¨Šï¼ˆå¾å¸Œé”ä¿‚æ•¸è¤‡è£½ï¼‰
  resource_id: string
  resource_name: string
  resource_version: string
  resource_published_date?: string

  // ========== ğŸ”‘ ä¾†æºè¿½è¹¤æ¬„ä½ ==========
  source_xida_id: number            // ä¾†æºå¸Œé”ä¿‚æ•¸ ID
  source_xida_version: string       // åŒ¯å…¥æ™‚å¸Œé”ä¿‚æ•¸çš„ç‰ˆæœ¬

  // ========== ğŸ”‘ ä¸­å¤®åº«å°ˆå±¬æ¬„ä½ ==========
  imported_to_central_at: string    // åŒ¯å…¥åˆ°ä¸­å¤®åº«çš„æ™‚é–“
  central_library_version: string   // ä¸­å¤®åº«ç‰ˆæœ¬ï¼ˆåˆå§‹ç‚º v1.0ï¼‰
  locked: boolean                   // æ˜¯å¦é–å®šç‰ˆæœ¬ï¼ˆé–å®šå¾Œä¸é¡¯ç¤ºæ›´æ–°é€šçŸ¥ï¼‰
  locked_reason?: string            // é–å®šåŸå› 
  locked_at?: string                // é–å®šæ™‚é–“
  locked_by?: string                // é–å®šæ“ä½œäºº

  // ========== ğŸ”‘ ä½¿ç”¨è¿½è¹¤ ==========
  usage_info: FactorUsageInfo       // å°ˆæ¡ˆå¼•ç”¨è³‡è¨Š

  // ========== ğŸ”‘ æ›´æ–°ç‹€æ…‹ ==========
  has_newer_version_available?: boolean       // æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬å¯ç”¨
  newer_version_info?: {
    xida_factor_id: number          // æ–°ç‰ˆæœ¬çš„å¸Œé”ä¿‚æ•¸ ID
    resource_id: string             // æ–°ç‰ˆæœ¬çš„è³‡æ–™ä¾†æº ID
    resource_name: string           // æ–°ç‰ˆæœ¬çš„è³‡æ–™ä¾†æºåç¨±
    version: string                 // æ–°ç‰ˆæœ¬è™Ÿ
    change_summary: string          // è®Šæ›´æ‘˜è¦
    notification_id: string         // é—œè¯çš„é€šçŸ¥ ID
    detected_at: string             // åµæ¸¬åˆ°æ–°ç‰ˆæœ¬çš„æ™‚é–“
  }

  // ========== å…ƒè³‡æ–™ ==========
  data_quality?: DataQuality        // è³‡æ–™å“è³ªç­‰ç´š
  validation_status?: ValidationStatus // é©—è­‰ç‹€æ…‹
}
```

### 3. FactorUpdateNotificationï¼ˆæ–°å¢ï¼‰

**èªªæ˜**ï¼šä¿‚æ•¸æ›´æ–°é€šçŸ¥

```typescript
/**
 * ä¿‚æ•¸æ›´æ–°é€šçŸ¥
 * ç•¶åµæ¸¬åˆ°å¸Œé”ä¿‚æ•¸æœ‰æ–°ç‰ˆæœ¬æ™‚å»ºç«‹
 */
export interface FactorUpdateNotification {
  // ========== åŸºæœ¬è³‡è¨Š ==========
  id: string                        // é€šçŸ¥ ID
  type: 'new_version_available'     // é€šçŸ¥é¡å‹
  severity: 'info' | 'warning' | 'critical' // åš´é‡ç¨‹åº¦

  // ========== ç•¶å‰ç‰ˆæœ¬è³‡è¨Šï¼ˆä¸­å¤®åº«ä¸­çš„ä¿‚æ•¸ï¼‰ ==========
  current_central_factor_id: number       // ä¸­å¤®åº«ç•¶å‰ä¿‚æ•¸ ID
  current_factor_name: string             // ç•¶å‰ä¿‚æ•¸åç¨±
  current_resource_id: string             // ç•¶å‰è³‡æ–™ä¾†æº ID
  current_version: string                 // ç•¶å‰ç‰ˆæœ¬è™Ÿ

  // ========== æ–°ç‰ˆæœ¬è³‡è¨Šï¼ˆå¸Œé”ä¿‚æ•¸åº«ä¸­çš„æ–°ä¿‚æ•¸ï¼‰ ==========
  new_xida_factor_id: number              // å¸Œé”æ–°ç‰ˆæœ¬ä¿‚æ•¸ ID
  new_factor_name: string                 // æ–°ç‰ˆæœ¬ä¿‚æ•¸åç¨±
  new_resource_id: string                 // æ–°ç‰ˆæœ¬è³‡æ–™ä¾†æº ID
  new_version: string                     // æ–°ç‰ˆæœ¬è™Ÿ

  // ========== æ¯”å°è³‡è¨Š ==========
  similarity_score: number                // åç¨±ç›¸ä¼¼åº¦è©•åˆ†ï¼ˆ0-1ï¼‰
  matched_by: 'exact_name' | 'similar_name' | 'manual' // åŒ¹é…æ–¹å¼
  match_confidence: 'high' | 'medium' | 'low' // åŒ¹é…ä¿¡å¿ƒåº¦

  // ========== è®Šæ›´åˆ†æ ==========
  changes: FactorFieldChange[]            // æ¬„ä½è®Šæ›´æ˜ç´°
  change_summary: string                  // è®Šæ›´æ‘˜è¦æ–‡å­—
  has_breaking_changes: boolean           // æ˜¯å¦æœ‰é‡å¤§è®Šæ›´

  // ========== å½±éŸ¿åˆ†æ ==========
  affected_projects: ProjectReference[]   // å—å½±éŸ¿çš„å°ˆæ¡ˆåˆ—è¡¨
  usage_count: number                     // ç•¶å‰ç‰ˆæœ¬è¢«å¼•ç”¨æ¬¡æ•¸
  impact_level: 'high' | 'medium' | 'low' // å½±éŸ¿ç¨‹åº¦

  // ========== ç‹€æ…‹è¿½è¹¤ ==========
  status: 'pending' | 'reviewed' | 'added_to_central' | 'ignored' | 'dismissed'
  created_at: string                      // é€šçŸ¥å»ºç«‹æ™‚é–“
  reviewed_at?: string                    // ä½¿ç”¨è€…æª¢è¦–æ™‚é–“
  resolved_at?: string                    // è™•ç†å®Œæˆæ™‚é–“

  // ========== æ“ä½œçµæœ ==========
  added_central_factor_id?: number        // å¦‚æœä½¿ç”¨è€…æ–°å¢ï¼Œè¨˜éŒ„æ–°ä¸­å¤®åº«ä¿‚æ•¸ ID
  user_action?: 'added' | 'ignored' | 'dismissed' // ä½¿ç”¨è€…æ“ä½œ
  user_notes?: string                     // ä½¿ç”¨è€…å‚™è¨»
}
```

### 4. FactorFieldChangeï¼ˆæ–°å¢ï¼‰

**èªªæ˜**ï¼šæ¬„ä½è®Šæ›´è¨˜éŒ„

```typescript
/**
 * ä¿‚æ•¸æ¬„ä½è®Šæ›´è¨˜éŒ„
 * ç”¨æ–¼è©³ç´°è¨˜éŒ„æ–°èˆŠç‰ˆæœ¬çš„æ¬„ä½å·®ç•°
 */
export interface FactorFieldChange {
  field_name: string                // æ¬„ä½åç¨±ï¼ˆç¨‹å¼ç¢¼ï¼‰
  field_label: string               // æ¬„ä½æ¨™ç±¤ï¼ˆä¸­æ–‡ï¼‰
  field_category: 'basic' | 'emission' | 'metadata' // æ¬„ä½é¡åˆ¥

  old_value: any                    // èˆŠå€¼
  new_value: any                    // æ–°å€¼

  value_type: 'number' | 'string' | 'date' | 'object' // å€¼é¡å‹
  change_type: 'modified' | 'added' | 'removed' // è®Šæ›´é¡å‹

  impact_level: 'high' | 'medium' | 'low' // å½±éŸ¿ç¨‹åº¦

  // æ•¸å€¼è®Šæ›´åˆ†æï¼ˆåƒ…æ•¸å€¼é¡å‹ï¼‰
  numeric_change?: {
    absolute_change: number         // çµ•å°è®ŠåŒ–é‡
    percentage_change: number       // ç™¾åˆ†æ¯”è®ŠåŒ–
    direction: 'increase' | 'decrease' // è®ŠåŒ–æ–¹å‘
  }

  // é¡¯ç¤ºæ ¼å¼
  display_format?: {
    old_display: string             // èˆŠå€¼é¡¯ç¤ºæ ¼å¼
    new_display: string             // æ–°å€¼é¡¯ç¤ºæ ¼å¼
    highlight: boolean              // æ˜¯å¦é«˜äº®é¡¯ç¤º
  }
}
```

### 5. FactorTableItem æ“´å±•

**èªªæ˜**ï¼šç‚ºè¡¨æ ¼é¡¯ç¤ºå¢åŠ æ›´æ–°ç‹€æ…‹æ¬„ä½

```typescript
export interface FactorTableItem {
  // ... ç¾æœ‰æ¬„ä½ä¿æŒä¸è®Š

  // ========== ğŸ†• æ–°å¢ï¼šæ›´æ–°ç‹€æ…‹ ==========
  has_newer_version?: boolean       // æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬å¯ç”¨
  newer_version_count?: number      // æ–°ç‰ˆæœ¬æ•¸é‡ï¼ˆå¯èƒ½æœ‰å¤šå€‹ï¼‰
  update_notification_ids?: string[] // é—œè¯çš„æ›´æ–°é€šçŸ¥ ID åˆ—è¡¨

  // ========== ğŸ†• æ–°å¢ï¼šä¾†æºè¿½è¹¤ï¼ˆç”¨æ–¼å¸Œé”ä¿‚æ•¸ï¼‰ ==========
  source_xida_id?: number           // ä¾†æºå¸Œé”ä¿‚æ•¸ ID
  source_resource_id?: string       // ä¾†æºè³‡æ–™ä¾†æº ID
}
```

---

## å¯¦æ–½æ­¥é©Ÿ

### éšæ®µ 1: è³‡æ–™å±¤æ”¹é€ 

#### æ­¥é©Ÿ 1.1: Mock è³‡æ–™æº–å‚™

**æª”æ¡ˆ**: `src/data/mockDatabase.ts`

**ç›®æ¨™**: æº–å‚™æ¸¬è©¦ç”¨çš„æ–°èˆŠç‰ˆæœ¬ä¿‚æ•¸è³‡æ–™

```typescript
// ========== èˆŠç‰ˆæœ¬ä¿‚æ•¸ (Resource_1) ==========
export const oldVersionFactor: EmissionFactor = {
  id: 1001,
  source: 'TW2050 2024Q1',
  name: 'é›»åŠ›-å°é›»é›»ç¶²å¹³å‡æ’æ”¾ä¿‚æ•¸',
  effective_date: '2024-01-01',
  continent: 'äºæ´²',
  country: 'å°ç£',
  region: 'å…¨åœ‹',
  co2_factor: 0.502,
  co2_unit: 'kg COâ‚‚/kWh',
  value: 0.502,
  unit: 'kg COâ‚‚e/kWh',
  year: 2024,
  method_gwp: 'GWP100',
  source_type: 'standard',
  source_ref: 'TW2050',
  version: 'v2.1.0',
  description: '2024å¹´ç¬¬ä¸€å­£å°é›»é›»ç¶²å¹³å‡æ’æ”¾ä¿‚æ•¸',
  created_at: '2024-01-01T00:00:00Z',
  updated_at: '2024-01-01T00:00:00Z',

  // ğŸ†• è³‡æ–™ä¾†æºè³‡è¨Š
  resource_id: 'Resource_1',
  resource_name: 'TW2050 2024Q1',
  resource_version: 'v2.1.0',
  resource_published_date: '2024-01-01',

  // ğŸ†• ä¸­å¤®åº«ç‹€æ…‹ï¼ˆå‡è¨­å·²åŒ¯å…¥ï¼‰
  in_central_library: true,
  central_library_copies: [{
    central_id: 5001,
    imported_at: '2024-02-15T10:30:00Z',
    locked: false
  }]
}

// ========== æ–°ç‰ˆæœ¬ä¿‚æ•¸ (Resource_8) ==========
export const newVersionFactor: EmissionFactor = {
  id: 1002,
  source: 'TW2050 2024Q3',
  name: 'é›»åŠ›-å°é›»é›»ç¶²å¹³å‡æ’æ”¾ä¿‚æ•¸',
  effective_date: '2024-07-01',
  continent: 'äºæ´²',
  country: 'å°ç£',
  region: 'å…¨åœ‹',
  co2_factor: 0.495,        // ğŸ”º è®Šæ›´ï¼šå¾ 0.502 é™è‡³ 0.495
  co2_unit: 'kg COâ‚‚/kWh',
  value: 0.495,             // ğŸ”º è®Šæ›´
  unit: 'kg COâ‚‚e/kWh',
  year: 2024,
  method_gwp: 'GWP100',
  source_type: 'standard',
  source_ref: 'TW2050',
  version: 'v2.3.0',        // ğŸ”º è®Šæ›´ï¼šç‰ˆæœ¬æ›´æ–°
  description: '2024å¹´ç¬¬ä¸‰å­£å°é›»é›»ç¶²å¹³å‡æ’æ”¾ä¿‚æ•¸ï¼Œåæ˜ å†ç”Ÿèƒ½æºå æ¯”æå‡',
  notes: 'æœ¬å­£æ›´æ–°ä¸»è¦å› æ‡‰å†ç”Ÿèƒ½æºç™¼é›»å æ¯”å¢åŠ ï¼Œå°è‡´æ•´é«”é›»ç¶²æ’æ”¾ä¿‚æ•¸ä¸‹é™',
  created_at: '2024-07-01T00:00:00Z',
  updated_at: '2024-07-01T00:00:00Z',

  // ğŸ†• è³‡æ–™ä¾†æºè³‡è¨Š
  resource_id: 'Resource_8',
  resource_name: 'TW2050 2024Q3',
  resource_version: 'v2.3.0',
  resource_published_date: '2024-07-01',

  // ğŸ†• ç‰ˆæœ¬é—œè¯è³‡è¨Š
  is_newer_version_of: {
    previous_resource_id: 'Resource_1',
    previous_factor_name: 'é›»åŠ›-å°é›»é›»ç¶²å¹³å‡æ’æ”¾ä¿‚æ•¸',
    update_reason: '2024å¹´ç¬¬ä¸‰å­£å°é›»é›»ç¶²æ’æ”¾ä¿‚æ•¸å®šæœŸæ›´æ–°',
    update_date: '2024-07-01',
    change_summary: 'æ’æ”¾ä¿‚æ•¸å¾ 0.502 é™è‡³ 0.495 kg COâ‚‚e/kWhï¼ˆé™ä½ 1.4%ï¼‰ï¼Œä¸»è¦å› æ‡‰å†ç”Ÿèƒ½æºå æ¯”æå‡',
    breaking_changes: false
  },

  // ğŸ†• ä¸­å¤®åº«ç‹€æ…‹ï¼ˆå°šæœªåŒ¯å…¥ï¼‰
  in_central_library: false
}

// ========== åŠ å…¥åˆ°ä¿‚æ•¸åˆ—è¡¨ ==========
export function getAllEmissionFactors(): EmissionFactor[] {
  return [
    ...factorList,         // ç¾æœ‰çš„ä¿‚æ•¸åˆ—è¡¨
    oldVersionFactor,      // Resource_1
    newVersionFactor,      // Resource_8
  ]
}
```

#### æ­¥é©Ÿ 1.2: ä¿®æ”¹ useMockData.ts

**æª”æ¡ˆ**: `src/hooks/useMockData.ts`

**ç›®æ¨™**:
1. æ–°å¢ä¸­å¤®åº«æ¨™æº–ä¿‚æ•¸å„²å­˜
2. ä¿®æ”¹å¸Œé”ä¿‚æ•¸åŒ¯å…¥é‚è¼¯ç‚ºè¤‡è£½æ¨¡å¼
3. æ–°å¢æ›´æ–°é€šçŸ¥ç®¡ç†å‡½æ•¸

```typescript
// ========== ğŸ†• å…¨åŸŸå„²å­˜ï¼šä¸­å¤®åº«æ¨™æº–ä¿‚æ•¸ ==========
let importedStandardFactors: CentralLibraryStandardFactor[] = []

// ========== ğŸ†• å…¨åŸŸå„²å­˜ï¼šæ›´æ–°é€šçŸ¥ ==========
let factorUpdateNotifications: FactorUpdateNotification[] = []

/**
 * ğŸ”„ ä¿®æ”¹ï¼šå°‡å¸Œé”ä¿‚æ•¸åŠ å…¥ä¸­å¤®åº«ï¼ˆæ”¹ç‚ºè¤‡è£½æ¨¡å¼ï¼‰
 */
export function addStandardFactorToCentral(factorId: number): {
  success: boolean
  message: string
  centralFactorId?: number
  error?: string
} {
  try {
    console.log('[addStandardFactorToCentral] å°‡å¸Œé”ä¿‚æ•¸è¤‡è£½åˆ°ä¸­å¤®åº«, factorId:', factorId)

    // 1. æª¢æŸ¥æ˜¯å¦å·²ç¶“åœ¨ä¸­å¤®åº«
    const existingCentral = importedStandardFactors.find(
      f => f.source_xida_id === factorId
    )

    if (existingCentral) {
      return {
        success: false,
        message: 'æ­¤ä¿‚æ•¸å·²åœ¨ä¸­å¤®ä¿‚æ•¸åº«ä¸­',
        centralFactorId: existingCentral.id
      }
    }

    // 2. å¾å¸Œé”ä¿‚æ•¸åº«å–å¾—åŸå§‹ä¿‚æ•¸
    const xidaFactor = getAllEmissionFactors().find(f => f.id === factorId)

    if (!xidaFactor) {
      return {
        success: false,
        message: 'æ‰¾ä¸åˆ°æŒ‡å®šçš„å¸Œé”ä¿‚æ•¸',
        error: `Factor ID ${factorId} not found`
      }
    }

    // 3. å»ºç«‹ä¸­å¤®åº«å‰¯æœ¬
    const centralLibraryId = Date.now()
    const currentTime = new Date().toISOString()

    const centralFactor: CentralLibraryStandardFactor = {
      // è¤‡è£½æ‰€æœ‰åŸºæœ¬è³‡è¨Š
      ...xidaFactor,

      // ğŸ”‘ è¦†å¯«é—œéµæ¬„ä½
      id: centralLibraryId,              // æ–°çš„ä¸­å¤®åº« ID
      type: 'central_standard_factor',   // é¡å‹æ¨™è¨˜

      // ğŸ”‘ ä¾†æºè¿½è¹¤
      source_xida_id: factorId,
      source_xida_version: xidaFactor.version,

      // ç¢ºä¿ resource_id å­˜åœ¨
      resource_id: xidaFactor.resource_id || 'Unknown',
      resource_name: xidaFactor.resource_name || xidaFactor.source,
      resource_version: xidaFactor.resource_version || xidaFactor.version,

      // ğŸ”‘ ä¸­å¤®åº«å°ˆå±¬æ¬„ä½
      imported_to_central_at: currentTime,
      central_library_version: 'v1.0',
      locked: false,

      // ğŸ”‘ åˆå§‹åŒ–ä½¿ç”¨è¿½è¹¤
      usage_info: {
        total_usage_count: 0,
        project_references: [],
        usage_summary: 'æœªè¢«å¼•ç”¨'
      }
    }

    // 4. åŠ å…¥ä¸­å¤®åº«é™£åˆ—
    importedStandardFactors.push(centralFactor)

    // 5. æ›´æ–°å¸Œé”ä¿‚æ•¸çš„ä¸­å¤®åº«ç‹€æ…‹
    if (!xidaFactor.in_central_library) {
      xidaFactor.in_central_library = true
    }
    if (!xidaFactor.central_library_copies) {
      xidaFactor.central_library_copies = []
    }
    xidaFactor.central_library_copies.push({
      central_id: centralLibraryId,
      imported_at: currentTime,
      locked: false
    })

    console.log('[addStandardFactorToCentral] æˆåŠŸè¤‡è£½åˆ°ä¸­å¤®åº«, centralId:', centralLibraryId)

    return {
      success: true,
      message: 'å·²æˆåŠŸåŠ å…¥ä¸­å¤®ä¿‚æ•¸åº«',
      centralFactorId: centralLibraryId
    }
  } catch (error) {
    console.error('[addStandardFactorToCentral] åŠ å…¥å¤±æ•—:', error)
    return {
      success: false,
      message: 'åŠ å…¥ä¸­å¤®ä¿‚æ•¸åº«å¤±æ•—',
      error: error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
    }
  }
}

/**
 * ğŸ”„ ä¿®æ”¹ï¼šå–å¾—ä¸­å¤®åº«ä¿‚æ•¸ï¼ˆåŒ…å«è¤‡è£½çš„å¸Œé”ä¿‚æ•¸ï¼‰
 */
export function getCentralLibraryFactors(): ExtendedFactorTableItem[] {
  // 1. åŒ¯å…¥çš„çµ„åˆä¿‚æ•¸
  const compositeFactors = getImportedCompositeFactors()

  // 2. ğŸ†• åŒ¯å…¥çš„å¸Œé”ä¿‚æ•¸ï¼ˆè¤‡è£½æ¨¡å¼ï¼‰
  const standardFactors = importedStandardFactors.map(factor =>
    convertCentralStandardFactorToTableItem(factor)
  )

  // 3. PACT ä¿‚æ•¸ï¼ˆä¿æŒç¾æœ‰é‚è¼¯ï¼‰
  const pactFactors = mockProductFootprintFactors
    .filter(f => !removedFromCentralIds.has(f.id))
    .map(convertProductFootprintToTableItem)

  return [
    ...compositeFactors,
    ...standardFactors,  // ğŸ†• åŠ å…¥è¤‡è£½çš„å¸Œé”ä¿‚æ•¸
    ...pactFactors
  ]
}

/**
 * ğŸ†• æ–°å¢ï¼šè½‰æ›ä¸­å¤®åº«æ¨™æº–ä¿‚æ•¸ç‚ºè¡¨æ ¼é …ç›®
 */
function convertCentralStandardFactorToTableItem(
  factor: CentralLibraryStandardFactor
): ExtendedFactorTableItem {
  return {
    id: factor.id,
    type: 'central_standard_factor',
    name: factor.name,
    value: factor.value,
    unit: factor.unit,
    year: factor.year,
    region: `${factor.country}${factor.region ? ' - ' + factor.region : ''}`,
    method_gwp: factor.method_gwp,
    source_type: factor.source_type,
    source_ref: factor.source_ref,
    version: factor.version,
    data: factor,

    // ä½¿ç”¨è¿½è¹¤
    usage_info: factor.usage_info,
    usageText: factor.usage_info.usage_summary,

    // ä¾†æºè¿½è¹¤
    source_xida_id: factor.source_xida_id,
    source_resource_id: factor.resource_id,

    // ğŸ†• æ›´æ–°ç‹€æ…‹
    has_newer_version: factor.has_newer_version_available,
    update_notification_ids: factor.newer_version_info
      ? [factor.newer_version_info.notification_id]
      : []
  }
}

/**
 * ğŸ†• æ–°å¢ï¼šå–å¾—ä¸­å¤®åº«æ¨™æº–ä¿‚æ•¸åˆ—è¡¨
 */
export function getImportedStandardFactors(): CentralLibraryStandardFactor[] {
  return importedStandardFactors
}

/**
 * ğŸ†• æ–°å¢ï¼šæ ¹æ“š ID å–å¾—ä¸­å¤®åº«æ¨™æº–ä¿‚æ•¸
 */
export function getImportedStandardFactorById(id: number): CentralLibraryStandardFactor | undefined {
  return importedStandardFactors.find(f => f.id === id)
}

/**
 * ğŸ†• æ–°å¢ï¼šå„²å­˜æ›´æ–°é€šçŸ¥
 */
export function addFactorUpdateNotification(
  notification: FactorUpdateNotification
): void {
  factorUpdateNotifications.push(notification)

  // åŒæ™‚æ›´æ–°ä¸­å¤®åº«ä¿‚æ•¸çš„ç‹€æ…‹
  const centralFactor = importedStandardFactors.find(
    f => f.id === notification.current_central_factor_id
  )

  if (centralFactor) {
    centralFactor.has_newer_version_available = true
    centralFactor.newer_version_info = {
      xida_factor_id: notification.new_xida_factor_id,
      resource_id: notification.new_resource_id,
      resource_name: notification.new_resource_id, // å¯å¾å¸Œé”ä¿‚æ•¸å–å¾—å®Œæ•´åç¨±
      version: notification.new_version,
      change_summary: notification.change_summary,
      notification_id: notification.id,
      detected_at: notification.created_at
    }
  }
}

/**
 * ğŸ†• æ–°å¢ï¼šå–å¾—æ‰€æœ‰æ›´æ–°é€šçŸ¥
 */
export function getFactorUpdateNotifications(
  status?: FactorUpdateNotification['status']
): FactorUpdateNotification[] {
  if (status) {
    return factorUpdateNotifications.filter(n => n.status === status)
  }
  return factorUpdateNotifications
}

/**
 * ğŸ†• æ–°å¢ï¼šå–å¾—å¾…è™•ç†çš„æ›´æ–°é€šçŸ¥æ•¸é‡
 */
export function getPendingUpdateNotificationCount(): number {
  return factorUpdateNotifications.filter(n => n.status === 'pending').length
}

/**
 * ğŸ†• æ–°å¢ï¼šæ›´æ–°é€šçŸ¥ç‹€æ…‹
 */
export function updateNotificationStatus(
  notificationId: string,
  status: FactorUpdateNotification['status'],
  userNotes?: string
): boolean {
  const notification = factorUpdateNotifications.find(n => n.id === notificationId)

  if (!notification) {
    return false
  }

  notification.status = status

  if (status === 'reviewed') {
    notification.reviewed_at = new Date().toISOString()
  }

  if (status === 'added_to_central' || status === 'ignored' || status === 'dismissed') {
    notification.resolved_at = new Date().toISOString()
  }

  if (userNotes) {
    notification.user_notes = userNotes
  }

  return true
}

/**
 * ğŸ†• æ–°å¢ï¼šè™•ç†æ›´æ–°é€šçŸ¥ - æ–°å¢æ–°ç‰ˆæœ¬åˆ°ä¸­å¤®åº«
 */
export function acceptFactorUpdate(
  notificationId: string
): {
  success: boolean
  message: string
  newCentralFactorId?: number
} {
  const notification = factorUpdateNotifications.find(n => n.id === notificationId)

  if (!notification) {
    return {
      success: false,
      message: 'æ‰¾ä¸åˆ°æŒ‡å®šçš„æ›´æ–°é€šçŸ¥'
    }
  }

  // æ–°å¢æ–°ç‰ˆæœ¬ä¿‚æ•¸åˆ°ä¸­å¤®åº«
  const result = addStandardFactorToCentral(notification.new_xida_factor_id)

  if (result.success && result.centralFactorId) {
    // æ›´æ–°é€šçŸ¥ç‹€æ…‹
    notification.status = 'added_to_central'
    notification.resolved_at = new Date().toISOString()
    notification.added_central_factor_id = result.centralFactorId
    notification.user_action = 'added'

    console.log('[acceptFactorUpdate] æ–°ç‰ˆæœ¬å·²åŠ å…¥ä¸­å¤®åº«, centralId:', result.centralFactorId)
  }

  return result
}

/**
 * ğŸ†• æ–°å¢ï¼šå¿½ç•¥æ›´æ–°é€šçŸ¥
 */
export function ignoreFactorUpdate(
  notificationId: string,
  reason?: string
): boolean {
  const notification = factorUpdateNotifications.find(n => n.id === notificationId)

  if (!notification) {
    return false
  }

  notification.status = 'ignored'
  notification.resolved_at = new Date().toISOString()
  notification.user_action = 'ignored'

  if (reason) {
    notification.user_notes = reason
  }

  console.log('[ignoreFactorUpdate] æ›´æ–°é€šçŸ¥å·²å¿½ç•¥, notificationId:', notificationId)

  return true
}

/**
 * ğŸ†• æ–°å¢ï¼šæ¸…é™¤å·²è™•ç†çš„é€šçŸ¥
 */
export function clearResolvedNotifications(): number {
  const beforeCount = factorUpdateNotifications.length

  factorUpdateNotifications = factorUpdateNotifications.filter(
    n => n.status === 'pending' || n.status === 'reviewed'
  )

  const clearedCount = beforeCount - factorUpdateNotifications.length

  console.log(`[clearResolvedNotifications] æ¸…é™¤äº† ${clearedCount} å€‹å·²è™•ç†é€šçŸ¥`)

  return clearedCount
}
```

---

### éšæ®µ 2: æ›´æ–°åµæ¸¬æœå‹™

#### æ­¥é©Ÿ 2.1: å»ºç«‹æ›´æ–°åµæ¸¬æœå‹™

**æª”æ¡ˆ**: `src/services/factorUpdateDetectionService.ts`ï¼ˆæ–°å»ºï¼‰

```typescript
import {
  EmissionFactor,
  CentralLibraryStandardFactor,
  FactorUpdateNotification,
  FactorFieldChange,
  ProjectReference
} from '@/types/types'
import { getFactorUsageById } from '@/data/factorProjectMapping'

/**
 * è¨ˆç®—å­—ä¸²ç›¸ä¼¼åº¦ï¼ˆLevenshtein Distanceï¼‰
 */
function calculateSimilarity(str1: string, str2: string): number {
  const len1 = str1.length
  const len2 = str2.length
  const matrix: number[][] = []

  // åˆå§‹åŒ–çŸ©é™£
  for (let i = 0; i <= len1; i++) {
    matrix[i] = [i]
  }
  for (let j = 0; j <= len2; j++) {
    matrix[0][j] = j
  }

  // è¨ˆç®—ç·¨è¼¯è·é›¢
  for (let i = 1; i <= len1; i++) {
    for (let j = 1; j <= len2; j++) {
      if (str1[i - 1] === str2[j - 1]) {
        matrix[i][j] = matrix[i - 1][j - 1]
      } else {
        matrix[i][j] = Math.min(
          matrix[i - 1][j - 1] + 1,  // æ›¿æ›
          matrix[i][j - 1] + 1,      // æ’å…¥
          matrix[i - 1][j] + 1       // åˆªé™¤
        )
      }
    }
  }

  const distance = matrix[len1][len2]
  const maxLen = Math.max(len1, len2)

  // è½‰æ›ç‚ºç›¸ä¼¼åº¦è©•åˆ†ï¼ˆ0-1ï¼‰
  return maxLen === 0 ? 1 : 1 - (distance / maxLen)
}

/**
 * æ‰¾å‡ºæ–°ä¿‚æ•¸å°æ‡‰çš„ä¸­å¤®åº«èˆŠä¿‚æ•¸
 */
export function findMatchingCentralFactors(
  newXidaFactor: EmissionFactor,
  centralLibraryFactors: CentralLibraryStandardFactor[]
): Array<{
  centralFactor: CentralLibraryStandardFactor
  similarity: number
  matchedBy: 'exact_name' | 'similar_name' | 'manual'
  confidence: 'high' | 'medium' | 'low'
}> {
  const matches: Array<{
    centralFactor: CentralLibraryStandardFactor
    similarity: number
    matchedBy: 'exact_name' | 'similar_name' | 'manual'
    confidence: 'high' | 'medium' | 'low'
  }> = []

  // æª¢æŸ¥æ˜¯å¦æœ‰ç‰ˆæœ¬é—œè¯è³‡è¨Š
  if (!newXidaFactor.is_newer_version_of) {
    console.log('[findMatchingCentralFactors] æ–°ä¿‚æ•¸ç„¡ç‰ˆæœ¬é—œè¯è³‡è¨Šï¼Œç„¡æ³•æ¯”å°')
    return matches
  }

  const { previous_resource_id, previous_factor_name } = newXidaFactor.is_newer_version_of

  console.log(`[findMatchingCentralFactors] å°‹æ‰¾ä¾†è‡ª ${previous_resource_id} çš„ä¿‚æ•¸`)

  // æ­¥é©Ÿ 1: æ‰¾å‡ºä¸­å¤®åº«ä¸­æ‰€æœ‰ä¾†è‡ªè©²è³‡æ–™ä¾†æºçš„ä¿‚æ•¸
  const candidateFactors = centralLibraryFactors.filter(
    f => f.resource_id === previous_resource_id
  )

  console.log(`[findMatchingCentralFactors] æ‰¾åˆ° ${candidateFactors.length} å€‹å€™é¸ä¿‚æ•¸`)

  if (candidateFactors.length === 0) {
    return matches
  }

  // æ­¥é©Ÿ 2: å°æ¯å€‹å€™é¸ä¿‚æ•¸è¨ˆç®—åç¨±ç›¸ä¼¼åº¦
  candidateFactors.forEach(candidate => {
    const similarity = calculateSimilarity(
      newXidaFactor.name.toLowerCase(),
      candidate.name.toLowerCase()
    )

    let matchedBy: 'exact_name' | 'similar_name' | 'manual' = 'similar_name'
    let confidence: 'high' | 'medium' | 'low' = 'low'

    // å®Œå…¨åŒ¹é…
    if (newXidaFactor.name === candidate.name) {
      matchedBy = 'exact_name'
      confidence = 'high'
    } else if (similarity >= 0.9) {
      confidence = 'high'
    } else if (similarity >= 0.8) {
      confidence = 'medium'
    }

    // ç›¸ä¼¼åº¦é–¾å€¼ï¼š0.8 ä»¥ä¸Šè¦–ç‚ºåŒ¹é…
    if (similarity >= 0.8) {
      matches.push({
        centralFactor: candidate,
        similarity,
        matchedBy,
        confidence
      })

      console.log(`[findMatchingCentralFactors] æ‰¾åˆ°åŒ¹é…: ${candidate.name} (ç›¸ä¼¼åº¦: ${similarity.toFixed(2)})`)
    }
  })

  // æŒ‰ç›¸ä¼¼åº¦æ’åº
  matches.sort((a, b) => b.similarity - a.similarity)

  return matches
}

/**
 * æ¯”è¼ƒå…©å€‹ä¿‚æ•¸çš„æ¬„ä½å·®ç•°
 */
export function compareFactorFields(
  oldFactor: CentralLibraryStandardFactor,
  newFactor: EmissionFactor
): FactorFieldChange[] {
  const changes: FactorFieldChange[] = []

  // å®šç¾©éœ€è¦æ¯”è¼ƒçš„æ¬„ä½
  const fieldsToCompare: Array<{
    key: keyof EmissionFactor
    label: string
    category: 'basic' | 'emission' | 'metadata'
    type: 'number' | 'string' | 'date' | 'object'
    impact: 'high' | 'medium' | 'low'
  }> = [
    // æ’æ”¾æ•¸æ“šï¼ˆé«˜å½±éŸ¿ï¼‰
    { key: 'co2_factor', label: 'COâ‚‚ æ’æ”¾ä¿‚æ•¸', category: 'emission', type: 'number', impact: 'high' },
    { key: 'value', label: 'ä¸»è¦ä¿‚æ•¸å€¼', category: 'emission', type: 'number', impact: 'high' },
    { key: 'ch4_factor', label: 'CHâ‚„ æ’æ”¾ä¿‚æ•¸', category: 'emission', type: 'number', impact: 'high' },
    { key: 'n2o_factor', label: 'Nâ‚‚O æ’æ”¾ä¿‚æ•¸', category: 'emission', type: 'number', impact: 'high' },

    // åŸºæœ¬è³‡è¨Šï¼ˆä¸­å½±éŸ¿ï¼‰
    { key: 'version', label: 'ç‰ˆæœ¬è™Ÿ', category: 'metadata', type: 'string', impact: 'medium' },
    { key: 'effective_date', label: 'å•Ÿç”¨æ—¥æœŸ', category: 'basic', type: 'date', impact: 'medium' },
    { key: 'unit', label: 'å–®ä½', category: 'basic', type: 'string', impact: 'medium' },
    { key: 'co2_unit', label: 'COâ‚‚ å–®ä½', category: 'emission', type: 'string', impact: 'medium' },
    { key: 'ch4_unit', label: 'CHâ‚„ å–®ä½', category: 'emission', type: 'string', impact: 'medium' },
    { key: 'n2o_unit', label: 'Nâ‚‚O å–®ä½', category: 'emission', type: 'string', impact: 'medium' },

    // æè¿°è³‡è¨Šï¼ˆä½å½±éŸ¿ï¼‰
    { key: 'description', label: 'æè¿°', category: 'metadata', type: 'string', impact: 'low' },
    { key: 'notes', label: 'å‚™è¨»', category: 'metadata', type: 'string', impact: 'low' },
    { key: 'method_gwp', label: 'GWP æ–¹æ³•', category: 'metadata', type: 'string', impact: 'low' },
  ]

  fieldsToCompare.forEach(({ key, label, category, type, impact }) => {
    const oldValue = oldFactor[key]
    const newValue = newFactor[key]

    // è·³éå…©è€…éƒ½ç‚ºç©ºçš„æƒ…æ³
    if (oldValue == null && newValue == null) return

    let changeType: 'modified' | 'added' | 'removed' = 'modified'

    if (oldValue == null && newValue != null) {
      changeType = 'added'
    } else if (oldValue != null && newValue == null) {
      changeType = 'removed'
    } else if (oldValue === newValue) {
      return // ç„¡è®Šæ›´
    }

    const change: FactorFieldChange = {
      field_name: key,
      field_label: label,
      field_category: category,
      old_value: oldValue,
      new_value: newValue,
      value_type: type,
      change_type: changeType,
      impact_level: impact
    }

    // æ•¸å€¼è®Šæ›´åˆ†æ
    if (type === 'number' && changeType === 'modified' &&
        typeof oldValue === 'number' && typeof newValue === 'number') {
      const absoluteChange = newValue - oldValue
      const percentageChange = (absoluteChange / oldValue) * 100

      change.numeric_change = {
        absolute_change: absoluteChange,
        percentage_change: percentageChange,
        direction: absoluteChange > 0 ? 'increase' : 'decrease'
      }

      change.display_format = {
        old_display: oldValue.toFixed(6),
        new_display: newValue.toFixed(6),
        highlight: Math.abs(percentageChange) > 1 // è®ŠåŒ–è¶…é 1% æ™‚é«˜äº®
      }
    }

    changes.push(change)
  })

  return changes
}

/**
 * ç”Ÿæˆè®Šæ›´æ‘˜è¦æ–‡å­—
 */
function generateChangeSummary(
  changes: FactorFieldChange[],
  newFactor: EmissionFactor
): string {
  // å„ªå…ˆä½¿ç”¨ä¿‚æ•¸è‡ªå¸¶çš„è®Šæ›´æ‘˜è¦
  if (newFactor.is_newer_version_of?.change_summary) {
    return newFactor.is_newer_version_of.change_summary
  }

  // å¦å‰‡è‡ªå‹•ç”Ÿæˆ
  const highImpactChanges = changes.filter(c => c.impact_level === 'high')

  if (highImpactChanges.length === 0) {
    return `å…±æœ‰ ${changes.length} å€‹æ¬„ä½æ›´æ–°`
  }

  // æ‰¾å‡ºä¸»è¦çš„æ•¸å€¼è®Šæ›´
  const mainChange = highImpactChanges.find(c => c.numeric_change)

  if (mainChange && mainChange.numeric_change) {
    const { percentage_change, direction } = mainChange.numeric_change
    const directionText = direction === 'increase' ? 'å¢åŠ ' : 'é™ä½'

    return `${mainChange.field_label}${directionText} ${Math.abs(percentage_change).toFixed(1)}%`
  }

  // é è¨­æ‘˜è¦
  return `${highImpactChanges[0].field_label}å¾ ${highImpactChanges[0].old_value} æ›´æ–°è‡³ ${highImpactChanges[0].new_value}`
}

/**
 * è©•ä¼°å½±éŸ¿ç¨‹åº¦
 */
function assessImpactLevel(
  changes: FactorFieldChange[],
  affectedProjects: ProjectReference[]
): 'high' | 'medium' | 'low' {
  // æœ‰é«˜å½±éŸ¿æ¬„ä½è®Šæ›´ + å¤šå€‹å°ˆæ¡ˆå¼•ç”¨ = é«˜å½±éŸ¿
  const hasHighImpactChanges = changes.some(c => c.impact_level === 'high')
  const projectCount = affectedProjects.length

  if (hasHighImpactChanges && projectCount >= 3) {
    return 'high'
  }

  if (hasHighImpactChanges || projectCount >= 1) {
    return 'medium'
  }

  return 'low'
}

/**
 * è©•ä¼°é€šçŸ¥åš´é‡ç¨‹åº¦
 */
function assessSeverity(
  changes: FactorFieldChange[],
  impactLevel: 'high' | 'medium' | 'low',
  hasBreakingChanges: boolean
): 'info' | 'warning' | 'critical' {
  if (hasBreakingChanges) {
    return 'critical'
  }

  if (impactLevel === 'high') {
    return 'warning'
  }

  return 'info'
}

/**
 * åµæ¸¬æ–°ç‰ˆæœ¬ä¸¦ç”Ÿæˆæ›´æ–°é€šçŸ¥
 */
export function detectNewVersions(
  newXidaFactors: EmissionFactor[],
  centralLibraryFactors: CentralLibraryStandardFactor[]
): FactorUpdateNotification[] {
  const notifications: FactorUpdateNotification[] = []

  // åªè™•ç†æœ‰ç‰ˆæœ¬é—œè¯è³‡è¨Šçš„æ–°ä¿‚æ•¸
  const updatedFactors = newXidaFactors.filter(
    f => f.is_newer_version_of != null
  )

  console.log(`[detectNewVersions] æ‰¾åˆ° ${updatedFactors.length} å€‹æ¨™è¨˜ç‚ºæ›´æ–°ç‰ˆçš„ä¿‚æ•¸`)

  updatedFactors.forEach(newFactor => {
    // æ‰¾å‡ºå°æ‡‰çš„ä¸­å¤®åº«èˆŠä¿‚æ•¸
    const matches = findMatchingCentralFactors(newFactor, centralLibraryFactors)

    if (matches.length === 0) {
      console.log(`[detectNewVersions] ç„¡æ³•æ‰¾åˆ° ${newFactor.name} çš„å°æ‡‰ä¸­å¤®åº«ä¿‚æ•¸`)
      return
    }

    console.log(`[detectNewVersions] ç‚º ${newFactor.name} æ‰¾åˆ° ${matches.length} å€‹åŒ¹é…`)

    // ç‚ºæ¯å€‹åŒ¹é…çš„èˆŠä¿‚æ•¸å»ºç«‹é€šçŸ¥
    matches.forEach(({ centralFactor, similarity, matchedBy, confidence }) => {
      // æ¯”è¼ƒæ¬„ä½å·®ç•°
      const changes = compareFactorFields(centralFactor, newFactor)

      if (changes.length === 0) {
        console.log(`[detectNewVersions] ${newFactor.name} ç„¡å¯¦è³ªè®Šæ›´ï¼Œè·³é`)
        return
      }

      // å–å¾—ä½¿ç”¨è³‡è¨Š
      const usageInfo = getFactorUsageById(centralFactor.id)
      const affectedProjects = usageInfo?.project_references || []
      const usageCount = usageInfo?.total_usage_count || 0

      // ç”Ÿæˆè®Šæ›´æ‘˜è¦
      const changeSummary = generateChangeSummary(changes, newFactor)

      // è©•ä¼°å½±éŸ¿
      const impactLevel = assessImpactLevel(changes, affectedProjects)
      const hasBreakingChanges = newFactor.is_newer_version_of?.breaking_changes || false
      const severity = assessSeverity(changes, impactLevel, hasBreakingChanges)

      // å»ºç«‹é€šçŸ¥
      const notificationId = `update_${centralFactor.id}_${newFactor.id}_${Date.now()}`

      const notification: FactorUpdateNotification = {
        id: notificationId,
        type: 'new_version_available',
        severity,

        // ç•¶å‰ç‰ˆæœ¬
        current_central_factor_id: centralFactor.id,
        current_factor_name: centralFactor.name,
        current_resource_id: centralFactor.resource_id,
        current_version: centralFactor.version,

        // æ–°ç‰ˆæœ¬
        new_xida_factor_id: newFactor.id,
        new_factor_name: newFactor.name,
        new_resource_id: newFactor.resource_id!,
        new_version: newFactor.version,

        // æ¯”å°è³‡è¨Š
        similarity_score: similarity,
        matched_by: matchedBy,
        match_confidence: confidence,

        // è®Šæ›´åˆ†æ
        changes,
        change_summary: changeSummary,
        has_breaking_changes: hasBreakingChanges,

        // å½±éŸ¿åˆ†æ
        affected_projects: affectedProjects,
        usage_count: usageCount,
        impact_level: impactLevel,

        // ç‹€æ…‹
        status: 'pending',
        created_at: new Date().toISOString()
      }

      notifications.push(notification)

      console.log(`[detectNewVersions] å»ºç«‹é€šçŸ¥: ${notificationId}`)
    })
  })

  console.log(`[detectNewVersions] ç¸½å…±å»ºç«‹äº† ${notifications.length} å€‹æ›´æ–°é€šçŸ¥`)

  return notifications
}

/**
 * æ‰¹æ¬¡åµæ¸¬æ›´æ–°ï¼ˆä¸»å…¥å£å‡½æ•¸ï¼‰
 */
export function batchDetectUpdates(
  xidaFactors: EmissionFactor[],
  centralFactors: CentralLibraryStandardFactor[]
): {
  notifications: FactorUpdateNotification[]
  summary: {
    total_new_versions: number
    total_notifications: number
    high_impact: number
    medium_impact: number
    low_impact: number
  }
} {
  console.log('[batchDetectUpdates] é–‹å§‹æ‰¹æ¬¡åµæ¸¬æ›´æ–°')

  const notifications = detectNewVersions(xidaFactors, centralFactors)

  const summary = {
    total_new_versions: xidaFactors.filter(f => f.is_newer_version_of).length,
    total_notifications: notifications.length,
    high_impact: notifications.filter(n => n.impact_level === 'high').length,
    medium_impact: notifications.filter(n => n.impact_level === 'medium').length,
    low_impact: notifications.filter(n => n.impact_level === 'low').length
  }

  console.log('[batchDetectUpdates] åµæ¸¬å®Œæˆ:', summary)

  return { notifications, summary }
}
```

---

### éšæ®µ 3: UI çµ„ä»¶é–‹ç™¼

#### æ­¥é©Ÿ 3.1: æ›´æ–°é€šçŸ¥å¾½ç« 

**æª”æ¡ˆ**: `src/components/FactorUpdateNotificationBadge.tsx`ï¼ˆæ–°å»ºï¼‰

**ç›®æ¨™**: åœ¨é ‚éƒ¨å°èˆªåˆ—é¡¯ç¤ºæ›´æ–°é€šçŸ¥å¾½ç« 

```typescript
'use client'

import {
  Box,
  Badge,
  IconButton,
  Popover,
  PopoverTrigger,
  PopoverContent,
  PopoverHeader,
  PopoverBody,
  PopoverArrow,
  VStack,
  HStack,
  Text,
  Button,
  Divider,
  Icon,
  useDisclosure
} from '@chakra-ui/react'
import { BellIcon, WarningIcon, InfoIcon } from '@chakra-ui/icons'
import { useFactorUpdateNotifications } from '@/hooks/useFactorUpdateNotifications'

interface FactorUpdateNotificationBadgeProps {
  onViewDetails: (notificationId: string) => void
}

export default function FactorUpdateNotificationBadge({
  onViewDetails
}: FactorUpdateNotificationBadgeProps) {
  const {
    pendingNotifications,
    pendingCount,
    markAsReviewed,
    dismiss
  } = useFactorUpdateNotifications()

  const { isOpen, onOpen, onClose } = useDisclosure()

  if (pendingCount === 0) return null

  // åš´é‡ç¨‹åº¦é¡è‰²æ˜ å°„
  const severityColorMap = {
    info: 'blue',
    warning: 'orange',
    critical: 'red'
  }

  // åš´é‡ç¨‹åº¦åœ–ç¤ºæ˜ å°„
  const severityIconMap = {
    info: InfoIcon,
    warning: WarningIcon,
    critical: WarningIcon
  }

  return (
    <Popover isOpen={isOpen} onOpen={onOpen} onClose={onClose} placement="bottom-end">
      <PopoverTrigger>
        <Box position="relative" display="inline-block">
          <IconButton
            icon={<BellIcon />}
            aria-label="ä¿‚æ•¸æ›´æ–°é€šçŸ¥"
            variant="ghost"
            size="md"
            colorScheme={pendingCount > 0 ? 'orange' : 'gray'}
          />
          {pendingCount > 0 && (
            <Badge
              position="absolute"
              top="-1"
              right="-1"
              colorScheme="red"
              borderRadius="full"
              fontSize="xs"
              px={2}
              py={0.5}
            >
              {pendingCount}
            </Badge>
          )}
        </Box>
      </PopoverTrigger>

      <PopoverContent w="450px" maxH="600px">
        <PopoverArrow />
        <PopoverHeader fontWeight="bold" borderBottomWidth="1px">
          <HStack justify="space-between">
            <Text>ä¿‚æ•¸æ›´æ–°é€šçŸ¥</Text>
            <Badge colorScheme="red" borderRadius="full">
              {pendingCount}
            </Badge>
          </HStack>
        </PopoverHeader>

        <PopoverBody maxH="500px" overflowY="auto" p={0}>
          <VStack align="stretch" spacing={0} divider={<Divider />}>
            {pendingNotifications.map(notification => {
              const colorScheme = severityColorMap[notification.severity]
              const SeverityIcon = severityIconMap[notification.severity]

              return (
                <Box
                  key={notification.id}
                  p={4}
                  _hover={{ bg: 'gray.50' }}
                  cursor="pointer"
                  transition="background 0.2s"
                >
                  <VStack align="stretch" spacing={2}>
                    {/* æ¨™é¡Œåˆ— */}
                    <HStack align="start" spacing={2}>
                      <Icon
                        as={SeverityIcon}
                        color={`${colorScheme}.500`}
                        boxSize={4}
                        mt={0.5}
                      />
                      <VStack align="start" spacing={0} flex={1}>
                        <Text fontSize="sm" fontWeight="medium" lineHeight="short">
                          {notification.current_factor_name}
                        </Text>
                        <HStack spacing={2} fontSize="xs" color="gray.600">
                          <Badge colorScheme="gray" fontSize="xs">
                            {notification.current_resource_id}
                          </Badge>
                          <Text>â†’</Text>
                          <Badge colorScheme="green" fontSize="xs">
                            {notification.new_resource_id}
                          </Badge>
                        </HStack>
                      </VStack>
                    </HStack>

                    {/* è®Šæ›´æ‘˜è¦ */}
                    <Text fontSize="xs" color="gray.700" pl={6}>
                      {notification.change_summary}
                    </Text>

                    {/* å½±éŸ¿è³‡è¨Š */}
                    {notification.usage_count > 0 && (
                      <HStack spacing={2} pl={6}>
                        <Badge
                          colorScheme={colorScheme}
                          fontSize="xs"
                          variant="subtle"
                        >
                          å½±éŸ¿ {notification.usage_count} æ¬¡å¼•ç”¨
                        </Badge>
                        {notification.has_breaking_changes && (
                          <Badge colorScheme="red" fontSize="xs">
                            é‡å¤§è®Šæ›´
                          </Badge>
                        )}
                      </HStack>
                    )}

                    {/* æ“ä½œæŒ‰éˆ• */}
                    <HStack spacing={2} pt={2} pl={6}>
                      <Button
                        size="xs"
                        variant="ghost"
                        colorScheme="gray"
                        onClick={(e) => {
                          e.stopPropagation()
                          dismiss(notification.id)
                        }}
                      >
                        å¿½ç•¥
                      </Button>
                      <Button
                        size="xs"
                        colorScheme="blue"
                        onClick={(e) => {
                          e.stopPropagation()
                          markAsReviewed(notification.id)
                          onViewDetails(notification.id)
                          onClose()
                        }}
                      >
                        æŸ¥çœ‹è©³æƒ…
                      </Button>
                    </HStack>
                  </VStack>
                </Box>
              )
            })}
          </VStack>
        </PopoverBody>
      </PopoverContent>
    </Popover>
  )
}
```

#### æ­¥é©Ÿ 3.2: æ›´æ–°æ¯”å° Modal

**æª”æ¡ˆ**: `src/components/FactorUpdateComparisonModal.tsx`ï¼ˆæ–°å»ºï¼‰

**ç›®æ¨™**: é¡¯ç¤ºæ–°èˆŠç‰ˆæœ¬çš„è©³ç´°å·®ç•°æ¯”å°

```typescript
'use client'

import {
  Modal,
  ModalOverlay,
  ModalContent,
  ModalHeader,
  ModalBody,
  ModalFooter,
  ModalCloseButton,
  Button,
  VStack,
  HStack,
  Text,
  Box,
  Badge,
  Table,
  Thead,
  Tbody,
  Tr,
  Th,
  Td,
  Divider,
  Icon,
  useToast,
  Tabs,
  TabList,
  TabPanels,
  Tab,
  TabPanel,
  Alert,
  AlertIcon,
  AlertTitle,
  AlertDescription
} from '@chakra-ui/react'
import {
  CheckIcon,
  CloseIcon,
  ArrowUpIcon,
  ArrowDownIcon,
  WarningIcon
} from '@chakra-ui/icons'
import { useState } from 'react'
import {
  FactorUpdateNotification,
  EmissionFactor,
  CentralLibraryStandardFactor
} from '@/types/types'

interface FactorUpdateComparisonModalProps {
  isOpen: boolean
  onClose: () => void
  notification: FactorUpdateNotification | null
  oldFactor: CentralLibraryStandardFactor | null
  newFactor: EmissionFactor | null
  onAccept: (notificationId: string) => void
  onIgnore: (notificationId: string) => void
}

export default function FactorUpdateComparisonModal({
  isOpen,
  onClose,
  notification,
  oldFactor,
  newFactor,
  onAccept,
  onIgnore
}: FactorUpdateComparisonModalProps) {
  const toast = useToast()
  const [isProcessing, setIsProcessing] = useState(false)

  if (!notification || !oldFactor || !newFactor) {
    return null
  }

  // è™•ç†æ¥å—æ›´æ–°
  const handleAccept = async () => {
    setIsProcessing(true)

    try {
      await onAccept(notification.id)

      toast({
        title: 'æ–°ç‰ˆæœ¬å·²åŠ å…¥ä¸­å¤®åº«',
        description: `ä¿‚æ•¸ã€Œ${newFactor.name}ã€å·²æˆåŠŸåŠ å…¥`,
        status: 'success',
        duration: 5000,
        isClosable: true
      })

      onClose()
    } catch (error) {
      toast({
        title: 'æ“ä½œå¤±æ•—',
        description: error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤',
        status: 'error',
        duration: 5000,
        isClosable: true
      })
    } finally {
      setIsProcessing(false)
    }
  }

  // è™•ç†å¿½ç•¥æ›´æ–°
  const handleIgnore = () => {
    onIgnore(notification.id)

    toast({
      title: 'å·²å¿½ç•¥æ›´æ–°',
      description: 'æ‚¨å¯ä»¥ç¨å¾Œåœ¨é€šçŸ¥ä¸­å¿ƒæŸ¥çœ‹',
      status: 'info',
      duration: 3000,
      isClosable: true
    })

    onClose()
  }

  // åš´é‡ç¨‹åº¦é¡è‰²
  const severityColorMap = {
    info: 'blue',
    warning: 'orange',
    critical: 'red'
  }

  const severityColor = severityColorMap[notification.severity]

  return (
    <Modal isOpen={isOpen} onClose={onClose} size="6xl">
      <ModalOverlay />
      <ModalContent maxH="90vh">
        <ModalHeader borderBottomWidth="1px">
          <VStack align="start" spacing={2}>
            <HStack>
              <Text>ä¿‚æ•¸æ›´æ–°æ¯”å°</Text>
              <Badge colorScheme={severityColor}>
                {notification.severity === 'critical' ? 'é‡å¤§æ›´æ–°' :
                 notification.severity === 'warning' ? 'é‡è¦æ›´æ–°' : 'ä¸€èˆ¬æ›´æ–°'}
              </Badge>
            </HStack>
            <Text fontSize="sm" fontWeight="normal" color="gray.600">
              {notification.current_factor_name}
            </Text>
          </VStack>
        </ModalHeader>
        <ModalCloseButton />

        <ModalBody overflowY="auto">
          <VStack align="stretch" spacing={6}>
            {/* è­¦å‘Šè¨Šæ¯ */}
            {notification.has_breaking_changes && (
              <Alert status="warning" variant="left-accent">
                <AlertIcon />
                <VStack align="start" spacing={1}>
                  <AlertTitle>é‡å¤§è®Šæ›´è­¦å‘Š</AlertTitle>
                  <AlertDescription fontSize="sm">
                    æ­¤æ›´æ–°åŒ…å«é‡å¤§è®Šæ›´ï¼Œå¯èƒ½å½±éŸ¿ç¾æœ‰è¨ˆç®—çµæœã€‚è«‹ä»”ç´°æª¢æŸ¥å·®ç•°å¾Œå†æ±ºå®šæ˜¯å¦æ¡ç”¨ã€‚
                  </AlertDescription>
                </VStack>
              </Alert>
            )}

            {/* å½±éŸ¿åˆ†æ */}
            {notification.usage_count > 0 && (
              <Box p={4} bg="orange.50" borderRadius="md" borderLeftWidth="4px" borderColor="orange.400">
                <VStack align="start" spacing={2}>
                  <HStack>
                    <Icon as={WarningIcon} color="orange.600" />
                    <Text fontWeight="medium" color="orange.900">
                      å½±éŸ¿åˆ†æ
                    </Text>
                  </HStack>
                  <Text fontSize="sm" color="orange.800">
                    ç•¶å‰ç‰ˆæœ¬è¢« <strong>{notification.usage_count}</strong> å€‹å°ˆæ¡ˆå¼•ç”¨ï¼Œ
                    æ¶‰åŠ <strong>{notification.affected_projects.length}</strong> å€‹å°ˆæ¡ˆï¼š
                  </Text>
                  <VStack align="start" spacing={1} pl={4}>
                    {notification.affected_projects.map(project => (
                      <HStack key={project.project_id} fontSize="sm">
                        <Badge colorScheme="orange" fontSize="xs">
                          {project.project_type}
                        </Badge>
                        <Text color="orange.800">{project.project_name}</Text>
                        <Text color="orange.600">
                          ({project.usage_count} æ¬¡å¼•ç”¨)
                        </Text>
                      </HStack>
                    ))}
                  </VStack>
                  <Text fontSize="xs" color="orange.700" pt={2}>
                    âš ï¸ æ–°å¢æ–°ç‰ˆæœ¬ä¸æœƒå½±éŸ¿ç¾æœ‰å¼•ç”¨ï¼ŒèˆŠç‰ˆæœ¬å°‡ç¹¼çºŒè¢«å°ˆæ¡ˆä½¿ç”¨
                  </Text>
                </VStack>
              </Box>
            )}

            {/* Tabsï¼šæ¦‚è¦½ / è©³ç´°å·®ç•° */}
            <Tabs colorScheme="blue">
              <TabList>
                <Tab>æ¦‚è¦½</Tab>
                <Tab>è©³ç´°å·®ç•°</Tab>
                <Tab>ç‰ˆæœ¬è³‡è¨Š</Tab>
              </TabList>

              <TabPanels>
                {/* Tab 1: æ¦‚è¦½ */}
                <TabPanel>
                  <VStack align="stretch" spacing={4}>
                    {/* è®Šæ›´æ‘˜è¦ */}
                    <Box>
                      <Text fontWeight="medium" mb={2}>è®Šæ›´æ‘˜è¦</Text>
                      <Text fontSize="sm" color="gray.700" p={3} bg="gray.50" borderRadius="md">
                        {notification.change_summary}
                      </Text>
                    </Box>

                    {/* ç‰ˆæœ¬å°æ¯” */}
                    <Box>
                      <Text fontWeight="medium" mb={2}>ç‰ˆæœ¬å°æ¯”</Text>
                      <HStack spacing={4} align="stretch">
                        {/* èˆŠç‰ˆæœ¬ */}
                        <Box flex={1} p={4} bg="red.50" borderRadius="md" borderWidth="1px" borderColor="red.200">
                          <VStack align="start" spacing={2}>
                            <Badge colorScheme="red">ç•¶å‰ç‰ˆæœ¬</Badge>
                            <Text fontSize="sm" fontWeight="medium">{oldFactor.resource_name}</Text>
                            <Text fontSize="xs" color="gray.600">ç‰ˆæœ¬: {oldFactor.version}</Text>
                            <Divider />
                            <VStack align="start" spacing={1} fontSize="sm">
                              <Text><strong>ä¸»è¦ä¿‚æ•¸å€¼:</strong> {oldFactor.value} {oldFactor.unit}</Text>
                              <Text><strong>å•Ÿç”¨æ—¥æœŸ:</strong> {oldFactor.effective_date}</Text>
                            </VStack>
                          </VStack>
                        </Box>

                        {/* æ–°ç‰ˆæœ¬ */}
                        <Box flex={1} p={4} bg="green.50" borderRadius="md" borderWidth="1px" borderColor="green.200">
                          <VStack align="start" spacing={2}>
                            <Badge colorScheme="green">æ–°ç‰ˆæœ¬</Badge>
                            <Text fontSize="sm" fontWeight="medium">{newFactor.resource_name}</Text>
                            <Text fontSize="xs" color="gray.600">ç‰ˆæœ¬: {newFactor.version}</Text>
                            <Divider />
                            <VStack align="start" spacing={1} fontSize="sm">
                              <Text><strong>ä¸»è¦ä¿‚æ•¸å€¼:</strong> {newFactor.value} {newFactor.unit}</Text>
                              <Text><strong>å•Ÿç”¨æ—¥æœŸ:</strong> {newFactor.effective_date}</Text>
                            </VStack>
                          </VStack>
                        </Box>
                      </HStack>
                    </Box>

                    {/* ä¸»è¦è®Šæ›´åˆ—è¡¨ */}
                    <Box>
                      <Text fontWeight="medium" mb={2}>ä¸»è¦è®Šæ›´ ({notification.changes.length})</Text>
                      <VStack align="stretch" spacing={2}>
                        {notification.changes
                          .filter(c => c.impact_level === 'high' || c.impact_level === 'medium')
                          .map((change, idx) => (
                            <HStack
                              key={idx}
                              p={3}
                              bg="gray.50"
                              borderRadius="md"
                              justify="space-between"
                            >
                              <HStack spacing={2}>
                                <Badge
                                  colorScheme={change.impact_level === 'high' ? 'red' : 'orange'}
                                  fontSize="xs"
                                >
                                  {change.field_label}
                                </Badge>
                                {change.numeric_change && (
                                  <Icon
                                    as={change.numeric_change.direction === 'increase' ? ArrowUpIcon : ArrowDownIcon}
                                    color={change.numeric_change.direction === 'increase' ? 'green.500' : 'red.500'}
                                    boxSize={3}
                                  />
                                )}
                              </HStack>
                              <HStack spacing={3} fontSize="sm">
                                <Text color="gray.600" textDecoration="line-through">
                                  {String(change.old_value)}
                                </Text>
                                <Text>â†’</Text>
                                <Text fontWeight="medium" color="green.600">
                                  {String(change.new_value)}
                                </Text>
                                {change.numeric_change && (
                                  <Badge
                                    colorScheme={Math.abs(change.numeric_change.percentage_change) > 5 ? 'red' : 'green'}
                                    fontSize="xs"
                                  >
                                    {change.numeric_change.percentage_change > 0 ? '+' : ''}
                                    {change.numeric_change.percentage_change.toFixed(2)}%
                                  </Badge>
                                )}
                              </HStack>
                            </HStack>
                          ))}
                      </VStack>
                    </Box>
                  </VStack>
                </TabPanel>

                {/* Tab 2: è©³ç´°å·®ç•° */}
                <TabPanel>
                  <Table variant="simple" size="sm">
                    <Thead>
                      <Tr>
                        <Th>æ¬„ä½</Th>
                        <Th>ç•¶å‰ç‰ˆæœ¬</Th>
                        <Th>æ–°ç‰ˆæœ¬</Th>
                        <Th>è®Šæ›´</Th>
                      </Tr>
                    </Thead>
                    <Tbody>
                      {notification.changes.map((change, idx) => (
                        <Tr
                          key={idx}
                          bg={change.impact_level === 'high' ? 'red.50' :
                              change.impact_level === 'medium' ? 'orange.50' : 'white'}
                        >
                          <Td>
                            <VStack align="start" spacing={0}>
                              <Text fontWeight="medium">{change.field_label}</Text>
                              <Badge
                                colorScheme={
                                  change.impact_level === 'high' ? 'red' :
                                  change.impact_level === 'medium' ? 'orange' : 'gray'
                                }
                                fontSize="xs"
                              >
                                {change.impact_level === 'high' ? 'é«˜å½±éŸ¿' :
                                 change.impact_level === 'medium' ? 'ä¸­å½±éŸ¿' : 'ä½å½±éŸ¿'}
                              </Badge>
                            </VStack>
                          </Td>
                          <Td>
                            <Text
                              fontSize="sm"
                              color={change.change_type === 'removed' ? 'red.600' : 'gray.700'}
                              textDecoration={change.change_type === 'modified' ? 'line-through' : 'none'}
                            >
                              {change.old_value == null ? '-' : String(change.old_value)}
                            </Text>
                          </Td>
                          <Td>
                            <Text
                              fontSize="sm"
                              fontWeight={change.change_type === 'modified' ? 'medium' : 'normal'}
                              color={change.change_type === 'added' ? 'green.600' : 'gray.700'}
                            >
                              {change.new_value == null ? '-' : String(change.new_value)}
                            </Text>
                          </Td>
                          <Td>
                            {change.numeric_change ? (
                              <VStack align="start" spacing={0}>
                                <HStack>
                                  <Icon
                                    as={change.numeric_change.direction === 'increase' ? ArrowUpIcon : ArrowDownIcon}
                                    color={change.numeric_change.direction === 'increase' ? 'green.500' : 'red.500'}
                                    boxSize={3}
                                  />
                                  <Text fontSize="xs" fontWeight="medium">
                                    {change.numeric_change.absolute_change > 0 ? '+' : ''}
                                    {change.numeric_change.absolute_change.toFixed(6)}
                                  </Text>
                                </HStack>
                                <Text fontSize="xs" color="gray.600">
                                  ({change.numeric_change.percentage_change > 0 ? '+' : ''}
                                  {change.numeric_change.percentage_change.toFixed(2)}%)
                                </Text>
                              </VStack>
                            ) : (
                              <Badge
                                colorScheme={
                                  change.change_type === 'added' ? 'green' :
                                  change.change_type === 'removed' ? 'red' : 'blue'
                                }
                                fontSize="xs"
                              >
                                {change.change_type === 'added' ? 'æ–°å¢' :
                                 change.change_type === 'removed' ? 'ç§»é™¤' : 'ä¿®æ”¹'}
                              </Badge>
                            )}
                          </Td>
                        </Tr>
                      ))}
                    </Tbody>
                  </Table>
                </TabPanel>

                {/* Tab 3: ç‰ˆæœ¬è³‡è¨Š */}
                <TabPanel>
                  <VStack align="stretch" spacing={4}>
                    {/* æ›´æ–°åŸå›  */}
                    {newFactor.is_newer_version_of?.update_reason && (
                      <Box>
                        <Text fontWeight="medium" mb={2}>æ›´æ–°åŸå› </Text>
                        <Text fontSize="sm" p={3} bg="blue.50" borderRadius="md">
                          {newFactor.is_newer_version_of.update_reason}
                        </Text>
                      </Box>
                    )}

                    {/* æè¿° */}
                    {newFactor.description && (
                      <Box>
                        <Text fontWeight="medium" mb={2}>æ–°ç‰ˆæœ¬æè¿°</Text>
                        <Text fontSize="sm" p={3} bg="gray.50" borderRadius="md">
                          {newFactor.description}
                        </Text>
                      </Box>
                    )}

                    {/* å‚™è¨» */}
                    {newFactor.notes && (
                      <Box>
                        <Text fontWeight="medium" mb={2}>å‚™è¨»</Text>
                        <Text fontSize="sm" p={3} bg="gray.50" borderRadius="md">
                          {newFactor.notes}
                        </Text>
                      </Box>
                    )}

                    {/* ç‰ˆæœ¬æ­·å² */}
                    <Box>
                      <Text fontWeight="medium" mb={2}>ç‰ˆæœ¬æ­·å²</Text>
                      <VStack align="stretch" spacing={2}>
                        <HStack p={3} bg="green.50" borderRadius="md">
                          <Badge colorScheme="green">æœ€æ–°</Badge>
                          <Text fontSize="sm" flex={1}>
                            {newFactor.resource_id} - {newFactor.version}
                          </Text>
                          <Text fontSize="xs" color="gray.600">
                            {new Date(newFactor.updated_at).toLocaleDateString('zh-TW')}
                          </Text>
                        </HStack>
                        <HStack p={3} bg="gray.50" borderRadius="md">
                          <Badge colorScheme="gray">ç•¶å‰</Badge>
                          <Text fontSize="sm" flex={1}>
                            {oldFactor.resource_id} - {oldFactor.version}
                          </Text>
                          <Text fontSize="xs" color="gray.600">
                            {new Date(oldFactor.updated_at).toLocaleDateString('zh-TW')}
                          </Text>
                        </HStack>
                      </VStack>
                    </Box>
                  </VStack>
                </TabPanel>
              </TabPanels>
            </Tabs>
          </VStack>
        </ModalBody>

        <ModalFooter borderTopWidth="1px">
          <HStack spacing={3}>
            <Button
              variant="ghost"
              onClick={handleIgnore}
              isDisabled={isProcessing}
            >
              ç¨å¾Œè™•ç†
            </Button>
            <Button
              colorScheme="gray"
              onClick={onClose}
              isDisabled={isProcessing}
            >
              å–æ¶ˆ
            </Button>
            <Button
              colorScheme="blue"
              leftIcon={<CheckIcon />}
              onClick={handleAccept}
              isLoading={isProcessing}
              loadingText="è™•ç†ä¸­..."
            >
              æ–°å¢åˆ°ä¸­å¤®åº«
            </Button>
          </HStack>
        </ModalFooter>
      </ModalContent>
    </Modal>
  )
}
```

---

### éšæ®µ 4: Hook æ•´åˆ

#### æ­¥é©Ÿ 4.1: å»ºç«‹æ›´æ–°é€šçŸ¥ Hook

**æª”æ¡ˆ**: `src/hooks/useFactorUpdateNotifications.ts`ï¼ˆæ–°å»ºï¼‰

```typescript
'use client'

import { useEffect, useState, useCallback } from 'react'
import { FactorUpdateNotification, EmissionFactor, CentralLibraryStandardFactor } from '@/types/types'
import { getAllEmissionFactors } from '@/data/mockDatabase'
import {
  getImportedStandardFactors,
  getFactorUpdateNotifications,
  getPendingUpdateNotificationCount,
  updateNotificationStatus,
  acceptFactorUpdate,
  ignoreFactorUpdate,
  addFactorUpdateNotification
} from '@/hooks/useMockData'
import { batchDetectUpdates } from '@/services/factorUpdateDetectionService'

/**
 * ä¿‚æ•¸æ›´æ–°é€šçŸ¥ Hook
 */
export function useFactorUpdateNotifications() {
  const [allNotifications, setAllNotifications] = useState<FactorUpdateNotification[]>([])
  const [pendingNotifications, setP endingNotifications] = useState<FactorUpdateNotification[]>([])
  const [pendingCount, setPendingCount] = useState(0)
  const [isChecking, setIsChecking] = useState(false)
  const [lastCheckTime, setLastCheckTime] = useState<Date | null>(null)

  // æª¢æŸ¥æ›´æ–°
  const checkForUpdates = useCallback(() => {
    setIsChecking(true)

    try {
      console.log('[useFactorUpdateNotifications] é–‹å§‹æª¢æŸ¥æ›´æ–°')

      // å–å¾—å¸Œé”ä¿‚æ•¸åº«çš„æ‰€æœ‰ä¿‚æ•¸
      const xidaFactors = getAllEmissionFactors()

      // å–å¾—ä¸­å¤®åº«çš„æ¨™æº–ä¿‚æ•¸
      const centralFactors = getImportedStandardFactors()

      // æ‰¹æ¬¡åµæ¸¬æ›´æ–°
      const { notifications, summary } = batchDetectUpdates(xidaFactors, centralFactors)

      console.log('[useFactorUpdateNotifications] åµæ¸¬çµæœ:', summary)

      // å„²å­˜æ–°é€šçŸ¥
      notifications.forEach(notification => {
        // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„é€šçŸ¥ï¼ˆé¿å…é‡è¤‡ï¼‰
        const existing = getFactorUpdateNotifications().find(
          n => n.current_central_factor_id === notification.current_central_factor_id &&
               n.new_xida_factor_id === notification.new_xida_factor_id
        )

        if (!existing) {
          addFactorUpdateNotification(notification)
        }
      })

      // æ›´æ–°ç‹€æ…‹
      refreshNotifications()
      setLastCheckTime(new Date())

    } catch (error) {
      console.error('[useFactorUpdateNotifications] æª¢æŸ¥æ›´æ–°å¤±æ•—:', error)
    } finally {
      setIsChecking(false)
    }
  }, [])

  // åˆ·æ–°é€šçŸ¥åˆ—è¡¨
  const refreshNotifications = useCallback(() => {
    const all = getFactorUpdateNotifications()
    const pending = getFactorUpdateNotifications('pending')
    const count = getPendingUpdateNotificationCount()

    setAllNotifications(all)
    setPendingNotifications(pending)
    setPendingCount(count)
  }, [])

  // æ¨™è¨˜ç‚ºå·²æª¢è¦–
  const markAsReviewed = useCallback((notificationId: string) => {
    updateNotificationStatus(notificationId, 'reviewed')
    refreshNotifications()
  }, [refreshNotifications])

  // æ¥å—æ›´æ–°
  const accept = useCallback(async (notificationId: string) => {
    const result = acceptFactorUpdate(notificationId)

    if (result.success) {
      refreshNotifications()
    }

    return result
  }, [refreshNotifications])

  // å¿½ç•¥æ›´æ–°
  const ignore = useCallback((notificationId: string, reason?: string) => {
    ignoreFactorUpdate(notificationId, reason)
    refreshNotifications()
  }, [refreshNotifications])

  // å¿½ç•¥ï¼ˆUI ä¸Šçš„å¿«é€Ÿæ“ä½œï¼‰
  const dismiss = useCallback((notificationId: string) => {
    updateNotificationStatus(notificationId, 'dismissed')
    refreshNotifications()
  }, [refreshNotifications])

  // åˆå§‹åŒ–æ™‚è¼‰å…¥ç¾æœ‰é€šçŸ¥
  useEffect(() => {
    refreshNotifications()
  }, [refreshNotifications])

  // å®šæœŸæª¢æŸ¥æ›´æ–°ï¼ˆæ¯ 5 åˆ†é˜ï¼‰
  useEffect(() => {
    // åˆå§‹æª¢æŸ¥
    checkForUpdates()

    // è¨­å®šå®šæ™‚å™¨ï¼ˆ5 åˆ†é˜ï¼‰
    const interval = setInterval(checkForUpdates, 5 * 60 * 1000)

    return () => clearInterval(interval)
  }, [checkForUpdates])

  return {
    allNotifications,
    pendingNotifications,
    pendingCount,
    isChecking,
    lastCheckTime,
    checkForUpdates,
    markAsReviewed,
    accept,
    ignore,
    dismiss,
    refreshNotifications
  }
}

/**
 * å–å¾—æŒ‡å®šé€šçŸ¥çš„è©³ç´°è³‡è¨Š
 */
export function useNotificationDetails(notificationId: string | null) {
  const [notification, setNotification] = useState<FactorUpdateNotification | null>(null)
  const [oldFactor, setOldFactor] = useState<CentralLibraryStandardFactor | null>(null)
  const [newFactor, setNewFactor] = useState<EmissionFactor | null>(null)

  useEffect(() => {
    if (!notificationId) {
      setNotification(null)
      setOldFactor(null)
      setNewFactor(null)
      return
    }

    const notif = getFactorUpdateNotifications().find(n => n.id === notificationId)

    if (!notif) {
      return
    }

    setNotification(notif)

    // å–å¾—ä¸­å¤®åº«èˆŠä¿‚æ•¸
    const oldF = getImportedStandardFactors().find(f => f.id === notif.current_central_factor_id)
    setOldFactor(oldF || null)

    // å–å¾—å¸Œé”æ–°ä¿‚æ•¸
    const newF = getAllEmissionFactors().find(f => f.id === notif.new_xida_factor_id)
    setNewFactor(newF || null)

  }, [notificationId])

  return {
    notification,
    oldFactor,
    newFactor
  }
}
```

---

### éšæ®µ 5: æ•´åˆåˆ°ä¸»é é¢

#### æ­¥é©Ÿ 5.1: ä¿®æ”¹ page.tsx

**æª”æ¡ˆ**: `src/app/page.tsx`

```typescript
// åœ¨æª”æ¡ˆé–‹é ­æ–°å¢åŒ¯å…¥
import FactorUpdateNotificationBadge from '@/components/FactorUpdateNotificationBadge'
import FactorUpdateComparisonModal from '@/components/FactorUpdateComparisonModal'
import { useFactorUpdateNotifications, useNotificationDetails } from '@/hooks/useFactorUpdateNotifications'

export default function HomePage() {
  // ... ç¾æœ‰çš„ç‹€æ…‹å’Œ hooks

  // ğŸ†• æ–°å¢ï¼šæ›´æ–°é€šçŸ¥ç›¸é—œ
  const updateNotifications = useFactorUpdateNotifications()
  const [selectedNotificationId, setSelectedNotificationId] = useState<string | null>(null)
  const notificationDetails = useNotificationDetails(selectedNotificationId)

  const {
    isOpen: isUpdateComparisonOpen,
    onOpen: onUpdateComparisonOpen,
    onClose: onUpdateComparisonClose
  } = useDisclosure()

  // ğŸ†• æ–°å¢ï¼šè™•ç†æŸ¥çœ‹æ›´æ–°è©³æƒ…
  const handleViewUpdateDetails = useCallback((notificationId: string) => {
    setSelectedNotificationId(notificationId)
    onUpdateComparisonOpen()
  }, [onUpdateComparisonOpen])

  // ğŸ†• æ–°å¢ï¼šè™•ç†æ¥å—æ›´æ–°
  const handleAcceptUpdate = useCallback(async (notificationId: string) => {
    const result = await updateNotifications.accept(notificationId)

    if (result.success) {
      // åˆ·æ–°ä¸­å¤®åº«åˆ—è¡¨
      setCentralLibraryUpdateKey(prev => prev + 1)
    }

    return result
  }, [updateNotifications])

  // ğŸ†• æ–°å¢ï¼šè™•ç†å¿½ç•¥æ›´æ–°
  const handleIgnoreUpdate = useCallback((notificationId: string) => {
    updateNotifications.ignore(notificationId)
  }, [updateNotifications])

  return (
    <ChakraProvider theme={theme}>
      <Box minH="100vh" bg="gray.50">
        {/* é ‚éƒ¨å°èˆªåˆ— */}
        <Box
          as="header"
          bg="white"
          borderBottom="1px"
          borderColor="gray.200"
          px={6}
          py={4}
        >
          <HStack justify="space-between">
            <Heading size="lg">æ’æ”¾ä¿‚æ•¸ç®¡ç†å¹³å°</Heading>

            <HStack spacing={4}>
              {/* ğŸ†• æ–°å¢ï¼šæ›´æ–°é€šçŸ¥å¾½ç«  */}
              <FactorUpdateNotificationBadge
                onViewDetails={handleViewUpdateDetails}
              />

              {/* å…¨åŸŸæœå°‹æŒ‰éˆ• */}
              <Button
                leftIcon={<SearchIcon />}
                variant="outline"
                onClick={onGlobalSearchOpen}
              >
                å…¨åŸŸæœå°‹
              </Button>
            </HStack>
          </HStack>
        </Box>

        {/* ... ç¾æœ‰çš„å…§å®¹ */}

        {/* ğŸ†• æ–°å¢ï¼šæ›´æ–°æ¯”å° Modal */}
        <FactorUpdateComparisonModal
          isOpen={isUpdateComparisonOpen}
          onClose={onUpdateComparisonClose}
          notification={notificationDetails.notification}
          oldFactor={notificationDetails.oldFactor}
          newFactor={notificationDetails.newFactor}
          onAccept={handleAcceptUpdate}
          onIgnore={handleIgnoreUpdate}
        />

        {/* ... å…¶ä»–ç¾æœ‰çš„ Modals */}
      </Box>
    </ChakraProvider>
  )
}
```

---

### éšæ®µ 6: æ¸¬è©¦è¨ˆç•«

#### 6.1 å–®å…ƒæ¸¬è©¦

**æ¸¬è©¦é‡é»**:
1. ç›¸ä¼¼åº¦è¨ˆç®—å‡½æ•¸
2. ä¿‚æ•¸æ¯”å°é‚è¼¯
3. å·®ç•°åˆ†æå‡½æ•¸
4. é€šçŸ¥ç”Ÿæˆé‚è¼¯

**æ¸¬è©¦æª”æ¡ˆ**: `src/services/__tests__/factorUpdateDetectionService.test.ts`

```typescript
import { calculateSimilarity, findMatchingCentralFactors, compareFactorFields } from '../factorUpdateDetectionService'

describe('factorUpdateDetectionService', () => {
  describe('calculateSimilarity', () => {
    it('should return 1 for identical strings', () => {
      expect(calculateSimilarity('test', 'test')).toBe(1)
    })

    it('should return high similarity for very similar strings', () => {
      const result = calculateSimilarity('é›»åŠ›-å°é›»é›»ç¶²å¹³å‡æ’æ”¾ä¿‚æ•¸', 'é›»åŠ›-å°é›»é›»ç¶²å¹³å‡æ’æ”¾ç³»æ•¸')
      expect(result).toBeGreaterThan(0.9)
    })

    it('should return low similarity for different strings', () => {
      const result = calculateSimilarity('é›»åŠ›', 'å¤©ç„¶æ°£')
      expect(result).toBeLessThan(0.5)
    })
  })

  // ... æ›´å¤šæ¸¬è©¦æ¡ˆä¾‹
})
```

#### 6.2 æ•´åˆæ¸¬è©¦

**æ¸¬è©¦å ´æ™¯**:
1. å®Œæ•´çš„æ›´æ–°åµæ¸¬æµç¨‹
2. é€šçŸ¥ç”Ÿæˆèˆ‡å„²å­˜
3. UI äº’å‹•æµç¨‹

#### 6.3 æ‰‹å‹•æ¸¬è©¦æ¸…å–®

- [ ] **å ´æ™¯ 1**: å¸Œé”ä¿‚æ•¸åº«æ–°å¢ Resource_8ï¼Œç³»çµ±åµæ¸¬åˆ°æ›´æ–°
- [ ] **å ´æ™¯ 2**: æŸ¥çœ‹æ›´æ–°é€šçŸ¥å¾½ç« ï¼Œæ•¸é‡æ­£ç¢ºé¡¯ç¤º
- [ ] **å ´æ™¯ 3**: é»æ“Šé€šçŸ¥ï¼Œé–‹å•Ÿæ¯”å° Modal
- [ ] **å ´æ™¯ 4**: æ¯”å° Modal æ­£ç¢ºé¡¯ç¤ºæ–°èˆŠç‰ˆæœ¬å·®ç•°
- [ ] **å ´æ™¯ 5**: æ¥å—æ›´æ–°ï¼Œæ–°ç‰ˆæœ¬æˆåŠŸåŠ å…¥ä¸­å¤®åº«
- [ ] **å ´æ™¯ 6**: èˆŠç‰ˆæœ¬ä»ä¿ç•™ï¼Œå°ˆæ¡ˆå¼•ç”¨ä¸å—å½±éŸ¿
- [ ] **å ´æ™¯ 7**: å¿½ç•¥æ›´æ–°ï¼Œé€šçŸ¥ç‹€æ…‹æ­£ç¢ºæ›´æ–°
- [ ] **å ´æ™¯ 8**: å¤šå€‹ç‰ˆæœ¬å¯ä¸¦å­˜æ–¼ä¸­å¤®åº«

---

## é©—æ”¶æ¨™æº–

### åŠŸèƒ½é©—æ”¶

#### âœ… è‡ªå‹•åµæ¸¬æ›´æ–°
- [ ] å¸Œé”ä¿‚æ•¸åº«æ–°å¢æ¨™è¨˜ç‚ºæ›´æ–°ç‰ˆçš„ä¿‚æ•¸æ™‚ï¼Œç³»çµ±èƒ½è‡ªå‹•åµæ¸¬
- [ ] åµæ¸¬é‚è¼¯èƒ½æ­£ç¢ºè­˜åˆ¥ `is_newer_version_of` é—œè¯
- [ ] æ¯”å°é‚è¼¯èƒ½æ‰¾åˆ°ä¸­å¤®åº«ä¸­å°æ‡‰çš„èˆŠä¿‚æ•¸
- [ ] åç¨±ç›¸ä¼¼åº¦è¨ˆç®—æº–ç¢ºï¼ˆç›¸ä¼¼åº¦ â‰¥ 0.8 è¦–ç‚ºåŒ¹é…ï¼‰

#### âœ… é€šçŸ¥é¡¯ç¤º
- [ ] é ‚éƒ¨å°èˆªåˆ—é¡¯ç¤ºæ›´æ–°é€šçŸ¥å¾½ç« 
- [ ] å¾½ç« æ•¸å­—æ­£ç¢ºé¡¯ç¤ºå¾…è™•ç†æ›´æ–°æ•¸é‡
- [ ] é»æ“Šå¾½ç« é¡¯ç¤ºé€šçŸ¥åˆ—è¡¨
- [ ] é€šçŸ¥åˆ—è¡¨é¡¯ç¤ºæ­£ç¢ºçš„è®Šæ›´æ‘˜è¦
- [ ] åš´é‡ç¨‹åº¦ï¼ˆinfo/warning/criticalï¼‰æ­£ç¢ºé¡¯ç¤º

#### âœ… å·®ç•°æ¯”å°
- [ ] æ¯”å° Modal æ­£ç¢ºé¡¯ç¤ºæ–°èˆŠç‰ˆæœ¬è³‡è¨Š
- [ ] æ¬„ä½å·®ç•°æ¸…æ¥šæ¨™ç¤ºï¼ˆç´…è‰²åˆªé™¤ç·š vs ç¶ è‰²é«˜äº®ï¼‰
- [ ] æ•¸å€¼è®Šæ›´é¡¯ç¤ºçµ•å°è®ŠåŒ–é‡å’Œç™¾åˆ†æ¯”
- [ ] é«˜å½±éŸ¿æ¬„ä½å„ªå…ˆé¡¯ç¤º
- [ ] ç‰ˆæœ¬è³‡è¨Šå®Œæ•´å‘ˆç¾

#### âœ… æ–°å¢æ“ä½œ
- [ ] é»æ“Šã€Œæ–°å¢åˆ°ä¸­å¤®åº«ã€æˆåŠŸåŸ·è¡Œ
- [ ] æ–°ç‰ˆæœ¬ä¿‚æ•¸æ­£ç¢ºåŠ å…¥ä¸­å¤®åº«
- [ ] æ–°ä¿‚æ•¸åˆå§‹ç‹€æ…‹ç‚ºã€Œæœªè¢«å¼•ç”¨ã€
- [ ] èˆŠä¿‚æ•¸ä¿æŒä¸è®Šï¼Œå°ˆæ¡ˆå¼•ç”¨ä¸å—å½±éŸ¿
- [ ] æ–°èˆŠç‰ˆæœ¬å¯ä¸¦å­˜æ–¼ä¸­å¤®åº«

#### âœ… é€šçŸ¥ç®¡ç†
- [ ] æ¨™è¨˜ç‚ºå·²æª¢è¦–å¾Œï¼Œé€šçŸ¥ç‹€æ…‹æ­£ç¢ºæ›´æ–°
- [ ] å¿½ç•¥æ›´æ–°å¾Œï¼Œé€šçŸ¥ä¸å†é¡¯ç¤ºåœ¨å¾…è™•ç†åˆ—è¡¨
- [ ] å·²è™•ç†çš„é€šçŸ¥å¯åœ¨æ­·å²è¨˜éŒ„ä¸­æŸ¥çœ‹

### UI/UX é©—æ”¶

#### âœ… è¦–è¦ºè¨­è¨ˆ
- [ ] æ›´æ–°é€šçŸ¥å¾½ç« ä½ç½®æ˜é¡¯
- [ ] åš´é‡ç¨‹åº¦ç”¨ä¸åŒé¡è‰²å€åˆ†ï¼ˆè—è‰²/æ©™è‰²/ç´…è‰²ï¼‰
- [ ] å½±éŸ¿åˆ†ææ¸…æ¥šé†’ç›®ï¼ˆæ©™è‰²èƒŒæ™¯ï¼‰
- [ ] å·®ç•°é«˜äº®æ•ˆæœæ˜é¡¯
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œåœ¨ä¸åŒè¢å¹•å°ºå¯¸ä¸‹æ­£å¸¸é¡¯ç¤º

#### âœ… äº’å‹•é«”é©—
- [ ] é€šçŸ¥åˆ—è¡¨å¯æ»¾å‹•æŸ¥çœ‹
- [ ] æ¯”å° Modal æ”¯æ´ Tab åˆ‡æ›
- [ ] æ“ä½œæŒ‰éˆ•ç‹€æ…‹æ¸…æ¥šï¼ˆloading/disabledï¼‰
- [ ] Toast æç¤ºè¨Šæ¯åŠæ™‚ä¸”æ¸…æ¥š
- [ ] æ“ä½œå¾Œç«‹å³åˆ·æ–°ç›¸é—œåˆ—è¡¨

### æ•ˆèƒ½é©—æ”¶

- [ ] æ›´æ–°åµæ¸¬è€—æ™‚ < 2 ç§’
- [ ] é€šçŸ¥åˆ—è¡¨æ¸²æŸ“æµæš¢
- [ ] æ¯”å° Modal é–‹å•Ÿé€Ÿåº¦ < 500ms
- [ ] å¤§é‡ä¿‚æ•¸ï¼ˆ1000+ï¼‰æ™‚æ•ˆèƒ½ä¸å—å½±éŸ¿

### è³‡æ–™å®Œæ•´æ€§é©—æ”¶

- [ ] æ–°ç‰ˆæœ¬ä¿‚æ•¸åŒ…å«æ‰€æœ‰å¿…è¦æ¬„ä½
- [ ] ä¾†æºè¿½è¹¤æ¬„ä½æ­£ç¢ºè¨­å®š
- [ ] ç‰ˆæœ¬é—œè¯è³‡è¨Šå®Œæ•´
- [ ] ä½¿ç”¨è¿½è¹¤ç¨ç«‹æ–¼å¸Œé”ä¿‚æ•¸

---

## å¾ŒçºŒå„ªåŒ–æ–¹å‘

### Phase 2 åŠŸèƒ½

1. **æ‰¹æ¬¡è™•ç†**
   - æ”¯æ´ä¸€æ¬¡æ¥å—å¤šå€‹æ›´æ–°
   - æ‰¹æ¬¡å¿½ç•¥ä½å½±éŸ¿æ›´æ–°

2. **æ™ºèƒ½æ¨è–¦**
   - æ ¹æ“šå°ˆæ¡ˆé¡å‹æ¨è–¦æ˜¯å¦æ¥å—æ›´æ–°
   - åŸºæ–¼è®Šæ›´å¹…åº¦è‡ªå‹•è©•ä¼°é¢¨éšª

3. **ç‰ˆæœ¬é–å®š**
   - å…è¨±é–å®šç‰¹å®šä¿‚æ•¸ç‰ˆæœ¬
   - é–å®šå¾Œä¸å†é¡¯ç¤ºæ›´æ–°é€šçŸ¥

4. **é€šçŸ¥è¨­å®š**
   - è‡ªè¨‚é€šçŸ¥é »ç‡
   - è¨­å®šé€šçŸ¥å„ªå…ˆç´šéæ¿¾

5. **æ­·å²æŸ¥è©¢**
   - æŸ¥çœ‹æ‰€æœ‰æ­·å²æ›´æ–°è¨˜éŒ„
   - æ”¯æ´æŒ‰æ™‚é–“/å½±éŸ¿ç¨‹åº¦ç¯©é¸

### Phase 3 åŠŸèƒ½

1. **éƒµä»¶é€šçŸ¥**
   - é‡å¤§æ›´æ–°ç™¼é€éƒµä»¶é€šçŸ¥
   - æ¯é€±æ›´æ–°æ‘˜è¦å ±å‘Š

2. **å½±éŸ¿åˆ†æå¢å¼·**
   - é è¦½æ¥å—æ›´æ–°å¾Œå°å°ˆæ¡ˆè¨ˆç®—çµæœçš„å½±éŸ¿
   - æ¨¡æ“¬è¨ˆç®—å·®ç•°

3. **è‡ªå‹•åŒ–æ¸¬è©¦**
   - æ–°ç‰ˆæœ¬ä¿‚æ•¸çš„è‡ªå‹•é©—è­‰
   - ç•°å¸¸åµæ¸¬èˆ‡è­¦å‘Š

---

## é™„éŒ„

### A. è³‡æ–™æµç¨‹åœ–

```mermaid
sequenceDiagram
    participant XL as å¸Œé”ä¿‚æ•¸åº«
    participant DS as åµæ¸¬æœå‹™
    participant NS as é€šçŸ¥æœå‹™
    participant CL as ä¸­å¤®åº«
    participant UI as ä½¿ç”¨è€…ä»‹é¢

    XL->>XL: æ–°å¢ Resource_8<br/>(æ¨™è¨˜ç‚º Resource_1 çš„æ–°ç‰ˆæœ¬)
    XL->>DS: å®šæœŸæª¢æŸ¥è§¸ç™¼
    DS->>CL: æŸ¥è©¢ä¾†è‡ª Resource_1 çš„ä¿‚æ•¸
    CL-->>DS: è¿”å›åŒ¹é…çš„ä¿‚æ•¸åˆ—è¡¨
    DS->>DS: åŸ·è¡Œåç¨±ç›¸ä¼¼åº¦æ¯”å°
    DS->>DS: è¨ˆç®—æ¬„ä½å·®ç•°
    DS->>NS: ç”Ÿæˆæ›´æ–°é€šçŸ¥
    NS->>CL: æ¨™è¨˜ä¿‚æ•¸æœ‰æ–°ç‰ˆæœ¬å¯ç”¨
    NS->>UI: é¡¯ç¤ºæ›´æ–°å¾½ç« 
    UI->>UI: ä½¿ç”¨è€…é»æ“ŠæŸ¥çœ‹è©³æƒ…
    UI->>NS: è«‹æ±‚é€šçŸ¥è©³ç´°è³‡è¨Š
    NS-->>UI: è¿”å›æ–°èˆŠç‰ˆæœ¬è³‡æ–™
    UI->>UI: é¡¯ç¤ºå·®ç•°æ¯”å° Modal
    UI->>UI: ä½¿ç”¨è€…é¸æ“‡ã€Œæ–°å¢åˆ°ä¸­å¤®åº«ã€
    UI->>CL: åŸ·è¡Œæ–°å¢æ“ä½œ
    CL->>XL: è¤‡è£½ Resource_8 ä¿‚æ•¸
    CL->>CL: ç”Ÿæˆæ–°çš„ä¸­å¤®åº« ID
    CL->>CL: è¨­å®šåˆå§‹ç‹€æ…‹ï¼ˆæœªè¢«å¼•ç”¨ï¼‰
    CL-->>UI: æ–°å¢æˆåŠŸ
    UI->>UI: åˆ·æ–°ä¸­å¤®åº«åˆ—è¡¨
    UI->>UI: é¡¯ç¤ºæˆåŠŸ Toast
```

### B. é—œéµç¨‹å¼ç¢¼ä½ç½®ç´¢å¼•

| åŠŸèƒ½æ¨¡çµ„ | æª”æ¡ˆè·¯å¾‘ | é—œéµå‡½æ•¸/çµ„ä»¶ |
|---------|---------|-------------|
| è³‡æ–™çµæ§‹ | `src/types/types.ts` | `CentralLibraryStandardFactor`, `FactorUpdateNotification` |
| Mock è³‡æ–™ | `src/data/mockDatabase.ts` | `oldVersionFactor`, `newVersionFactor` |
| è³‡æ–™ç®¡ç† | `src/hooks/useMockData.ts` | `addStandardFactorToCentral`, `acceptFactorUpdate` |
| åµæ¸¬æœå‹™ | `src/services/factorUpdateDetectionService.ts` | `detectNewVersions`, `compareFactorFields` |
| é€šçŸ¥ Hook | `src/hooks/useFactorUpdateNotifications.ts` | `useFactorUpdateNotifications` |
| é€šçŸ¥å¾½ç«  | `src/components/FactorUpdateNotificationBadge.tsx` | `FactorUpdateNotificationBadge` |
| æ¯”å° Modal | `src/components/FactorUpdateComparisonModal.tsx` | `FactorUpdateComparisonModal` |
| ä¸»é é¢æ•´åˆ | `src/app/page.tsx` | `handleViewUpdateDetails`, `handleAcceptUpdate` |

---

**æ–‡ä»¶çµæŸ**
